<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Reprodutseeritav andmeanalüüs kasutades R programmi</title>
  <meta name="description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs kasutades R programmi’ materjalid.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Reprodutseeritav andmeanalüüs kasutades R programmi" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs kasutades R programmi’ materjalid." />
  <meta name="github-repo" content="rstats-tartu/lectures" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Reprodutseeritav andmeanalüüs kasutades R programmi" />
  
  <meta name="twitter:description" content="Praktilise kursuse ‘Reprodutseeritav andmeanalüüs kasutades R programmi’ materjalid." />
  

<meta name="author" content="Taavi Päll, Ülo Maiväli">


<meta name="date" content="2017-09-15">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="pakettide-installeerimine.html">
<link rel="next" href="funs.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />








<script src="https://use.fontawesome.com/e4ba4259a1.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reprodutseeritav andmeanalüüs R programmiga</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Haara kannel, Vanemuine!</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Sissejuhatus</a></li>
<li class="chapter" data-level="3" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>3</b> Tarkvaratööriistad</a><ul>
<li class="chapter" data-level="3.1" data-path="tools.html"><a href="tools.html#installeeri-vajalikud-programmid"><i class="fa fa-check"></i><b>3.1</b> Installeeri vajalikud programmid</a></li>
<li class="chapter" data-level="3.2" data-path="tools.html"><a href="tools.html#loo-githubi-konto"><i class="fa fa-check"></i><b>3.2</b> Loo GitHubi konto</a></li>
<li class="chapter" data-level="3.3" data-path="tools.html"><a href="tools.html#loo-uus-r-projekt"><i class="fa fa-check"></i><b>3.3</b> Loo uus R projekt</a></li>
<li class="chapter" data-level="3.4" data-path="tools.html"><a href="tools.html#git-merge-konfliktid"><i class="fa fa-check"></i><b>3.4</b> Git <em>Merge</em> konfliktid</a></li>
<li class="chapter" data-level="3.5" data-path="tools.html"><a href="tools.html#r-projekti-kataloogi-soovitatav-minimaalne-struktuur"><i class="fa fa-check"></i><b>3.5</b> R projekti kataloogi soovitatav minimaalne struktuur</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pakettide-installeerimine.html"><a href="pakettide-installeerimine.html"><i class="fa fa-check"></i><b>4</b> Pakettide installeerimine</a><ul>
<li class="chapter" data-level="4.1" data-path="pakettide-installeerimine.html"><a href="pakettide-installeerimine.html#r-repositooriumid"><i class="fa fa-check"></i><b>4.1</b> R repositooriumid</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html"><i class="fa fa-check"></i><b>5</b> R on kalkulaator</a><ul>
<li class="chapter" data-level="5.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#r-objektid"><i class="fa fa-check"></i><b>5.1</b> R objektid</a><ul>
<li class="chapter" data-level="5.1.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#objekt-ja-nimi"><i class="fa fa-check"></i><b>5.1.1</b> Objekt ja nimi</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#objektide-tuubid"><i class="fa fa-check"></i><b>5.2</b> Objektide tüübid</a><ul>
<li class="chapter" data-level="5.2.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#vektor---andmerida"><i class="fa fa-check"></i><b>5.2.1</b> Vektor - andmerida</a></li>
<li class="chapter" data-level="5.2.2" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#uus-vektor-seq-ja-rep"><i class="fa fa-check"></i><b>5.2.2</b> Uus vektor: <code>seq()</code> ja <code>rep()</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#tehted-arvuliste-vektoritega"><i class="fa fa-check"></i><b>5.2.3</b> tehted arvuliste vektoritega</a></li>
<li class="chapter" data-level="5.2.4" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#list-andmekott"><i class="fa fa-check"></i><b>5.2.4</b> List – andmekott</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#tibble-ja-data-frame---andmeraamid"><i class="fa fa-check"></i><b>5.3</b> Tibble ja data frame - andmeraamid</a><ul>
<li class="chapter" data-level="5.3.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#uhendame-kaks-tibblet-rea-kaupa"><i class="fa fa-check"></i><b>5.3.1</b> Ühendame kaks tibblet rea kaupa</a></li>
<li class="chapter" data-level="5.3.2" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#andmeraamide-salvestamine-eksport-import"><i class="fa fa-check"></i><b>5.3.2</b> Andmeraamide salvestamine (eksport-import)</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#tabelit-sisse-lugedes-vaata-ule-na-d"><i class="fa fa-check"></i><b>5.4</b> tabelit sisse lugedes vaata üle NA-d</a><ul>
<li class="chapter" data-level="5.4.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#matrix---numbriraam"><i class="fa fa-check"></i><b>5.4.1</b> 4. Matrix - numbriraam</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#andmete-tuubid"><i class="fa fa-check"></i><b>5.5</b> Andmete tüübid</a></li>
<li class="chapter" data-level="5.6" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#indekseerimine"><i class="fa fa-check"></i><b>5.6</b> Indekseerimine</a><ul>
<li class="chapter" data-level="5.6.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#vektorid-ja-nende-indeksid-on-uhe-dimensionaalsed"><i class="fa fa-check"></i><b>5.6.1</b> Vektorid ja nende indeksid on ühe-dimensionaalsed</a></li>
<li class="chapter" data-level="5.6.2" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#andmeraamid-ja-maatriksid-on-kahe-dimensionaalsed-nagu-ka-nende-indeksid"><i class="fa fa-check"></i><b>5.6.2</b> andmeraamid ja maatriksid on kahe-dimensionaalsed, nagu ka nende indeksid</a></li>
<li class="chapter" data-level="5.6.3" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#litside-indeksid-on-kolme-dimensionaalsed"><i class="fa fa-check"></i><b>5.6.3</b> litside indeksid on kolme-dimensionaalsed</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#regular-expression-ja-find-replace"><i class="fa fa-check"></i><b>5.7</b> Regular expression ja find &amp; replace</a></li>
<li class="chapter" data-level="5.8" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#tidyverse"><i class="fa fa-check"></i><b>5.8</b> Tidyverse</a><ul>
<li class="chapter" data-level="5.8.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#tidy-tabeli-struktuur"><i class="fa fa-check"></i><b>5.8.1</b> Tidy tabeli struktuur</a></li>
<li class="chapter" data-level="5.8.2" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#tabeli-dimensioonide-muutmine-pikk-ja-lai-formaat"><i class="fa fa-check"></i><b>5.8.2</b> Tabeli dimensioonide muutmine (pikk ja lai formaat)</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#dplyr-i-5-verbi"><i class="fa fa-check"></i><b>5.9</b> dplyr-i 5 verbi</a><ul>
<li class="chapter" data-level="5.9.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#select-columns"><i class="fa fa-check"></i><b>5.9.1</b> <code>select()</code> columns</a></li>
<li class="chapter" data-level="5.9.2" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#filter-rows"><i class="fa fa-check"></i><b>5.9.2</b> <code>filter()</code> rows</a></li>
<li class="chapter" data-level="5.9.3" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#summarise"><i class="fa fa-check"></i><b>5.9.3</b> <code>summarise()</code></a></li>
<li class="chapter" data-level="5.9.4" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#group_by"><i class="fa fa-check"></i><b>5.9.4</b> <code>group_by()</code></a></li>
<li class="chapter" data-level="5.9.5" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#mutate"><i class="fa fa-check"></i><b>5.9.5</b> 5. mutate</a></li>
<li class="chapter" data-level="5.9.6" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#grouped-filters"><i class="fa fa-check"></i><b>5.9.6</b> Grouped filters</a></li>
<li class="chapter" data-level="5.9.7" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#separate-one-column-into-several"><i class="fa fa-check"></i><b>5.9.7</b> <code>separate()</code> one column into several</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#faktorid"><i class="fa fa-check"></i><b>5.10</b> Faktorid</a><ul>
<li class="chapter" data-level="5.10.1" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#fct_recode-rekodeerib-faktori-tasemed"><i class="fa fa-check"></i><b>5.10.1</b> <code>fct_recode()</code> rekodeerib faktori tasemed</a></li>
<li class="chapter" data-level="5.10.2" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#fct_collapse-annab-argumenti-sisse-vanade-tasemete-vektori-et-teha-vahem-uusi-tasemeid."><i class="fa fa-check"></i><b>5.10.2</b> <code>fct_collapse()</code> annab argumenti sisse vanade tasemete vektori, et teha vähem uusi tasemeid.</a></li>
<li class="chapter" data-level="5.10.3" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#fct_lump-loob-kokku-koik-vahem-arv-kordi-esinevad-tasemed."><i class="fa fa-check"></i><b>5.10.3</b> <code>fct_lump()</code> lööb kokku kõik vähem arv kordi esinevad tasemed.</a></li>
<li class="chapter" data-level="5.10.4" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#rekodeerime-pideva-muutuja-faktoriks"><i class="fa fa-check"></i><b>5.10.4</b> Rekodeerime pideva muutuja faktoriks</a></li>
<li class="chapter" data-level="5.10.5" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#muudame-faktori-tasemete-jarjekorda-joonisel"><i class="fa fa-check"></i><b>5.10.5</b> Muudame faktori tasemete järjekorda joonisel</a></li>
<li class="chapter" data-level="5.10.6" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#fct_relevel-tostab-joonisel-osad-tasemed-teistest-ettepoole"><i class="fa fa-check"></i><b>5.10.6</b> <code>fct_relevel()</code> tõstab joonisel osad tasemed teistest ettepoole</a></li>
<li class="chapter" data-level="5.10.7" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#joontega-plotil-saab-fct_reorder2-abil-assotseerida-y-vaartused-suurimate-x-vaartustega"><i class="fa fa-check"></i><b>5.10.7</b> Joontega plotil saab <code>fct_reorder2()</code> abil assotseerida y väärtused suurimate x väärtustega</a></li>
<li class="chapter" data-level="5.10.8" data-path="r-on-kalkulaator.html"><a href="r-on-kalkulaator.html#tulpdiagrammide-korral-kasuta-fct_infreq"><i class="fa fa-check"></i><b>5.10.8</b> Tulpdiagrammide korral kasuta <code>fct_infreq()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="funs.html"><a href="funs.html"><i class="fa fa-check"></i><b>6</b> R on andmeanalüüsi keel, mille verbid on funktsioonid</a><ul>
<li class="chapter" data-level="6.1" data-path="funs.html"><a href="funs.html#kirjutame-oma-esimese-r-funktsiooni"><i class="fa fa-check"></i><b>6.1</b> Kirjutame oma esimese R funktsiooni</a></li>
<li class="chapter" data-level="6.2" data-path="funs.html"><a href="funs.html#funktsioonide-raamatukogud"><i class="fa fa-check"></i><b>6.2</b> Funktsioonide raamatukogud</a></li>
<li class="chapter" data-level="6.3" data-path="funs.html"><a href="funs.html#paiguta-koigi-raamatukogude-lugemine-koodi-algusesse"><i class="fa fa-check"></i><b>6.3</b> Paiguta kõigi raamatukogude lugemine koodi algusesse</a></li>
<li class="chapter" data-level="6.4" data-path="funs.html"><a href="funs.html#hurraa-uus-arvuti-aga-mis-libraryd-mul-olid"><i class="fa fa-check"></i><b>6.4</b> Hurraa, uus arvuti! aga mis libraryd mul olid…</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliograafia.html"><a href="bibliograafia.html"><i class="fa fa-check"></i>Bibliograafia</a></li>
<li class="chapter" data-level="7" data-path="bayesiaanlik-statistika.html"><a href="bayesiaanlik-statistika.html"><i class="fa fa-check"></i><b>7</b> Bayesiaanlik statistika</a><ul>
<li class="chapter" data-level="7.1" data-path="bayesiaanlik-statistika.html"><a href="bayesiaanlik-statistika.html#ajaloost-ja-toenaosusest"><i class="fa fa-check"></i><b>7.1</b> Ajaloost ja tõenäosusest</a><ul>
<li class="chapter" data-level="7.1.1" data-path="bayesiaanlik-statistika.html"><a href="bayesiaanlik-statistika.html#naide-kahe-grupi-vordlus"><i class="fa fa-check"></i><b>7.1.1</b> Näide: kahe grupi võrdlus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html"><i class="fa fa-check"></i><b>8</b> 1. osa: Mudel ja maailm</a><ul>
<li class="chapter" data-level="8.0.1" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#suur-ja-vaike-maailm"><i class="fa fa-check"></i><b>8.0.1</b> Suur ja väike maailm</a></li>
<li class="chapter" data-level="8.0.2" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#mudeli-vaike-maailm"><i class="fa fa-check"></i><b>8.0.2</b> Mudeli väike maailm</a></li>
<li class="chapter" data-level="8.0.3" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#millest-koosneb-mudel"><i class="fa fa-check"></i><b>8.0.3</b> Millest koosneb mudel?</a></li>
<li class="chapter" data-level="8.0.4" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#moistet"><i class="fa fa-check"></i><b>8.0.4</b> 4 mõistet</a></li>
<li class="chapter" data-level="8.0.5" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#mudeli-fittimine"><i class="fa fa-check"></i><b>8.0.5</b> Mudeli fittimine</a></li>
<li class="chapter" data-level="8.0.6" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#veamudel"><i class="fa fa-check"></i><b>8.0.6</b> Veamudel</a></li>
<li class="chapter" data-level="8.0.7" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#statistiline-mudel-koosneb-3-komponendist"><i class="fa fa-check"></i><b>8.0.7</b> Statistiline mudel koosneb 3 komponendist:</a></li>
<li class="chapter" data-level="8.0.8" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#normaaljaotuse-ja-lognormaaljaotuse-erilisus"><i class="fa fa-check"></i><b>8.0.8</b> normaaljaotuse ja lognormaaljaotuse erilisus</a></li>
<li class="chapter" data-level="8.1" data-path="osa-mudel-ja-maailm.html"><a href="osa-mudel-ja-maailm.html#kusimused-mida-statistika-kusib"><i class="fa fa-check"></i><b>8.1</b> Küsimused, mida statistika küsib</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html"><i class="fa fa-check"></i><b>9</b> 2 osa. Kuidas näevad välja teie andmed?</a><ul>
<li class="chapter" data-level="9.1" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#summaarsed-statistikud"><i class="fa fa-check"></i><b>9.1</b> summaarsed statistikud</a><ul>
<li class="chapter" data-level="9.1.1" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#keskvaartused"><i class="fa fa-check"></i><b>9.1.1</b> keskväärtused</a></li>
<li class="chapter" data-level="9.1.2" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#muutuja-sisene-varieeruvus"><i class="fa fa-check"></i><b>9.1.2</b> muutuja sisene varieeruvus</a></li>
<li class="chapter" data-level="9.1.3" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#muutujate-koos-varieeruvus"><i class="fa fa-check"></i><b>9.1.3</b> muutujate koos-varieeruvus</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#eda-eksploratoorne-andmeanaluus"><i class="fa fa-check"></i><b>9.2</b> 2.2 EDA — eksploratoorne andmeanalüüs</a><ul>
<li class="chapter" data-level="9.2.1" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#kuidas-uurida-muutuja-sisest-varieeruvust"><i class="fa fa-check"></i><b>9.2.1</b> Kuidas uurida muutuja sisest varieeruvust</a></li>
<li class="chapter" data-level="9.2.2" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#kahe-muutuja-koos-varieerumine"><i class="fa fa-check"></i><b>9.2.2</b> Kahe muutuja koos-varieerumine</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="osa-kuidas-naevad-valja-teie-andmed.html"><a href="osa-kuidas-naevad-valja-teie-andmed.html#joongraafikud"><i class="fa fa-check"></i><b>9.3</b> Joongraafikud</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="jata-meelde.html"><a href="jata-meelde.html"><i class="fa fa-check"></i><b>10</b> Jäta meelde:</a><ul>
<li class="chapter" data-level="10.1" data-path="jata-meelde.html"><a href="jata-meelde.html#sonastik"><i class="fa fa-check"></i><b>10.1</b> Sõnastik</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html"><i class="fa fa-check"></i><b>11</b> Järeldav statistika</a><ul>
<li class="chapter" data-level="11.0.1" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#simulatsiooni-joud"><i class="fa fa-check"></i><b>11.0.1</b> 3.1. Simulatsiooni jõud</a></li>
<li class="chapter" data-level="11.0.2" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#valim-ei-ole-sama-mis-populatsioon"><i class="fa fa-check"></i><b>11.0.2</b> 3.1.1. Valim ei ole sama, mis populatsioon</a></li>
<li class="chapter" data-level="11.0.3" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#bootstrappimine"><i class="fa fa-check"></i><b>11.0.3</b> 3.1.2. Bootstrappimine</a></li>
<li class="chapter" data-level="11.1" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#bayesi-pohimote"><i class="fa fa-check"></i><b>11.1</b> 3.2. Bayesi põhimõte</a><ul>
<li class="chapter" data-level="11.1.1" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#naide"><i class="fa fa-check"></i><b>11.1.1</b> 1. näide</a></li>
<li class="chapter" data-level="11.1.2" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#naide-sonastame-oma-probleemi-umber"><i class="fa fa-check"></i><b>11.1.2</b> 2. näide: sõnastame oma probleemi ümber</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#mudelite-keel"><i class="fa fa-check"></i><b>11.2</b> 2.3. Mudelite keel</a><ul>
<li class="chapter" data-level="11.2.1" data-path="jareldav-statistika.html"><a href="jareldav-statistika.html#beta-prior"><i class="fa fa-check"></i><b>11.2.1</b> beta prior</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstats-tartu/lectures" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reprodutseeritav andmeanalüüs kasutades R programmi</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-on-kalkulaator" class="section level1">
<h1><span class="header-section-number">5</span> R on kalkulaator</h1>
<p>Selleks, et R aru saaks, et tegu on temale mõeldud käsu, aga mitte tavatekstiga, Rmarkdown failis, tuleb see R koodirida spetsiaalsesse <strong>ümbrisesse või koodialasse</strong> (i.k. <em>chunk</em>) pakendada. Uue koodiümbrise saad sisestada koodieditori servast “Insert” &gt; “R” abil. Sisetatud R kood evalueeritakse siis, kui vajutad tekinud hallis koodialas rohelisele nupule või alternatiivselt, kui soovid jooksutada ainult osa koodi või üht koodirida, siis pane kursor soovitud reale või võta osa koodi blokki ja vajuta klaviatuuril cmd + enter.</p>
<p>Liidame <code>2 + 2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Nüüd trükiti see vastus konsooli kujul <code>[1] 4</code>. See tähendab, et <code>2 + 2 = 4</code>.</p>
<p>Kontrollime seda:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">answer &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">4</span>
## Trükime vastuse välja
answer</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Vastus on TRUE, (logical).</p>
<p>Pane tähele, et aritmeetiline võrdusmärk on <code>==</code> (sest = tähendab hoopis väärtuse määramist objektile/argumendile).</p>
<p>Veel mõned näidisarvutused:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 3 astmes 2</span>
<span class="dv">3</span> <span class="op">**</span><span class="st"> </span><span class="dv">2</span>
<span class="co"># Ruutjuur 3st</span>
<span class="kw">sqrt</span>(<span class="dv">3</span>)
<span class="co"># Naturaallogaritm sajast</span>
<span class="kw">log</span>(<span class="dv">100</span>)</code></pre></div>
<p>Arvule <span class="math inline">\(\pi\)</span> on määratud oma objekt <code>pi</code>. Seega on soovitav enda poolt loodavatele objektidele mitte panna nimeks “pi”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Ümarda pi neljale komakohale</span>
<span class="kw">round</span>(pi, <span class="dv">4</span>)</code></pre></div>
<pre><code>## [1] 3.1416</code></pre>
<p>Ümardamine on oluline tulemuste väljaprintimisel.</p>
<div id="r-objektid" class="section level2">
<h2><span class="header-section-number">5.1</span> R objektid</h2>
<p>R-i töökeskkonnas “workspace” asuvad <strong>objektid</strong>, millega me töötame. Tüüpilised objektid on:</p>
<ul>
<li>Andmekogud (vektorid, tabelid, maatriksid, listid jm).</li>
<li>Statistiliste analüüside väljundid.</li>
<li>Funktsioonid, mille oleme ise sisse lugenud.</li>
</ul>
<p>Käsk <code>ls()</code> annab objektide nimed teie workspace-s:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>()</code></pre></div>
<pre><code>## [1] &quot;answer&quot;</code></pre>
<p><code>rm(a)</code> removes object a from the workspace</p>
<p>Selleks, et salvestada töökeskkond faili kasuta <i class="fa fa-floppy-o" aria-hidden="true"></i> “Save” nuppu “Environment” akna servast või menüüst “Session” -&gt; “Save Workspace As”.</p>
<div id="objekt-ja-nimi" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Objekt ja nimi</h3>
<p>kui teil sünnib laps, annate talle nime.</p>
<p>R-s on vastupidi: nimele antakse objekt</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">babe &lt;-<span class="st"> &quot;beebi&quot;</span>
babe</code></pre></div>
<pre><code>## [1] &quot;beebi&quot;</code></pre>
<p>Siin on kõigepealt nimi (babe), siis assingmenti sümbol &lt;- ja lõpuks objekt, mis on nimele antud (string “beebi”).</p>
<p>NB! stringid on jutumärkides, nimed mitte</p>
<p>nimi üksi evalueeritakse kui “print object”, mis antud juhul on string “beebi”</p>
<p>Nüüd muudame objekti nime taga</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">babe &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;saatan&quot;</span>, <span class="st">&quot;inglike&quot;</span>)
babe</code></pre></div>
<pre><code>## [1] &quot;saatan&quot;  &quot;inglike&quot;</code></pre>
<p>Tulemuseks on sama nimi, mis tähistab nüüd midagi muud (vektorit, mis koosneb 2st stringist). Objekt “beebi” kaotas oma nime ja on nüüd workspacest kadunud.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(babe)</code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>class() annab meile objekti tüübi. Antud juhul <em>character vector</em>.</p>
<blockquote>
<p>Ainult need objektid, mis on assigneeritud nimele, lähevad workspace ja on sellistena kasutatvad edasises analüüsis.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">apples &lt;-<span class="st"> </span><span class="dv">2</span>
bananas &lt;-<span class="st"> </span><span class="dv">3</span>
apples <span class="op">+</span><span class="st"> </span>bananas</code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>objekt 5 ei ole nimetatud, seega ei ilmu see ka workspace</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="dv">2</span>
b &lt;-<span class="st"> </span><span class="dv">3</span>
a &lt;-<span class="st"> </span>a<span class="op">+</span>b
<span class="kw">str</span>(a) <span class="co">#objekti nimega a struktuur</span></code></pre></div>
<pre><code>##  num 5</code></pre>
<p>Nüüd on nimega a seostatud uus objekt, mis koosneb numbrist 5 (olles ühe elemendiga vektor). Ja nimega a eelnevalt seostatud objekt, mis koosnes numbrist 2, on workspacest lahkunud.</p>
<div id="nimede-vorm" class="section level4">
<h4><span class="header-section-number">5.1.1.1</span> Nimede vorm</h4>
<ul>
<li><p>Nimed algavad tähemärgiga, mitte numbriga ega $€%&amp;/?~ˇöõüä</p></li>
<li><p>Nimed ei sisalda tühikuid</p></li>
<li><p>Tühiku asemel kasuta alakriipsu: näiteks eriti_pikk_nimi</p></li>
<li><p>SUURED ja väiksed tähed on nimes erinevad</p></li>
<li><p>Nimed peaksid kirjeldama objekti, mis on sellele nimele assigneeritud ja nad võivad olla pikad sest TAB klahv annab meile auto-complete.</p></li>
<li><p>alt + - on otsetee &lt;- jaoks</p></li>
</ul>
</div>
<div id="sama-koodi-saab-kirjutada-neljal-viisil" class="section level4">
<h4><span class="header-section-number">5.1.1.2</span> Sama koodi saab kirjutada neljal viisil</h4>
<p>Hargnevate teede aed: kui me muudame olemasolevat objekti on meil alati kaks valikut. Me kas jätame muudetud objektile vana objekti nime või me anname talle uue nime. Esimesel juhul läheb vana muutmata objekt workspacest kaduma aga nimesid ei tule juurde ja säilib teatud workflow sujuvus. Teisel juhul jäävad analüüsi vaheobjektid meile alles ja nende juurde saab alati tagasi tulla. Samas tekkib meile palju sarnaste nimedega objekte.</p>
<p>Esimnene võimalus</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)
a &lt;-<span class="st"> </span><span class="kw">sum</span>(a)
a &lt;-<span class="st"> </span><span class="kw">sqrt</span>(a)
a &lt;-<span class="st"> </span><span class="kw">round</span>(a, <span class="dv">2</span>)
a</code></pre></div>
<pre><code>## [1] 2.24</code></pre>
<p>Teine võimalus</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)
a1 &lt;-<span class="st"> </span><span class="kw">sum</span>(a)
a2 &lt;-<span class="st"> </span><span class="kw">sqrt</span>(a1)
a3 &lt;-<span class="st"> </span><span class="kw">round</span>(a2, <span class="dv">2</span>)
a3</code></pre></div>
<pre><code>## [1] 2.24</code></pre>
<p>Kolmas võimalus on lühem variant esimesest. Me nimelt ühendame etapid toru <code>%&gt;%</code> kaudu. Siin me võtame objekti a (nö. andmed), suuname selle funktsiooni <code>sum()</code>, võtame selle funktsiooni väljundi ja suuname selle omakorda funktsiooni <code>sqrt()</code>. Seejärel võtame selle funktsiooni outputi ja määrame selle nimele “result” (aga võime selle ka mõne teise nimega siduda). Kui mõni funktsioon võtab ainult ühe parameetri, mille me talle toru kaudu sisse sõõdame, siis pole selle funktsiooni taga isegi sulge vaja. NB! R hea stiili juhised soovitavad siiski ka sellisel juhul kasutada funktsiooni koos sulgudega! See on hea lühike ja inimloetav viis koodi kirjutada, mis on masina jaoks identne esimese koodiga.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## we need piping operator &#39;%&gt;%&#39; from magrittr
<span class="kw">library</span>(magrittr)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;magrittr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)
result &lt;-<span class="st"> </span>a <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sqrt</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)
result</code></pre></div>
<pre><code>## [1] 2.24</code></pre>
<p>Neljas võimalus: Kõrgharitud programmeerija kirjutaks selle koodi aga nii:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)
a &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">sqrt</span>(<span class="kw">sum</span>(a)), <span class="dv">2</span>)
a</code></pre></div>
<pre><code>## [1] 2.24</code></pre>
<p>Sellist koodi loetakse keskelt väljappoole ja kirjutattakse alates viimasest operatsioonist, mida soovitakse, et kood teeks. Masina jaoks pole vahet. Inimese jaoks on küll: 4. variant nõuab hästi pestud ajusid.</p>
<p>Koodi lühidus 4 –&gt; 3 –&gt; 1 –&gt; 2 (pikem)</p>
<p>lollikindlus 1 –&gt; 2 –&gt; 3 –&gt; 4 (vähem lollikindel)</p>
<p>Mida vähem on kohti, kus saab koodi töötamist kontrollida, seda halvem teile. Sellepärast ärge kunagi pange üksteise otsa rohkem kui 4 torujuppi. See on teie otsustada, millist koodivormi te millal kasutate, aga te peaksite oskama lugeda neid kõiki.</p>
</div>
</div>
</div>
<div id="objektide-tuubid" class="section level2">
<h2><span class="header-section-number">5.2</span> Objektide tüübid</h2>
<div id="vektor---andmerida" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Vektor - andmerida</h3>
<p>Vektor on rida kindlas järjekorras arve, tähemärke või TRUE/FALSE loogilisi väärtusi. Iga vektor sisaldab ainult ühte tüüpi andmeid. Vektor on elementaarüksus, millega me teeme tehteid. Andmetabelis ripuvad kõrvuti ühepikad vektorid (üks vektor = üks tulp) ja R-le meeldib arvutada vektori kaupa vasakult paremale (mis tabelis on ülevalt alla sest vektori algus on üleval tabeli headeri juures). Vektori loomiseks kasuta funktsiooni c() — combine</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minu_vektor &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>)
<span class="kw">str</span>(minu_vektor)</code></pre></div>
<pre><code>##  num [1:3] 1 3 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minu_vektor &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>, <span class="dv">4</span>)
minu_vektor</code></pre></div>
<pre><code>## [1]  1 NA  4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(minu_vektor)</code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minu_vektor &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="st">&quot;A1&quot;</span>, <span class="st">&quot;4$&quot;</span>, <span class="st">&quot;joe&quot;</span>)
minu_vektor</code></pre></div>
<pre><code>## [1] &quot;1&quot;   &quot;A1&quot;  &quot;4$&quot;  &quot;joe&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(minu_vektor)</code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Piisab ühest tõrvatilgast meepotis, et teie vektor ei sisaldaks enam numbreid.</p>
<p>Järgneva trikiga saab mitte-numbrilisest vektorist numbrilise vektori.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
minu_vektor &lt;-<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">parse_number</span>(minu_vektor))</code></pre></div>
<pre><code>## Warning: 1 parsing failure.
## row # A tibble: 1 x 4 col     row   col expected actual expected   &lt;int&gt; &lt;int&gt;    &lt;chr&gt;  &lt;chr&gt; actual 1     4    NA a number    joe</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minu_vektor</code></pre></div>
<pre><code>## [1]  1  1  4 NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(minu_vektor)</code></pre></div>
<pre><code>##  num [1:4] 1 1 4 NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sort</span>(x, <span class="dt">decreasing =</span> <span class="ot">FALSE</span>, ...) <span class="co">#sorts vector in ascending order</span>
<span class="kw">unique</span>(x) <span class="co">#returns a vector or data frame, but with duplicate elements/rows removed.</span></code></pre></div>
</div>
<div id="uus-vektor-seq-ja-rep" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Uus vektor: <code>seq()</code> ja <code>rep()</code></h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">by =</span> <span class="fl">0.5</span>)</code></pre></div>
<pre><code>## [1] 2.0 2.5 3.0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">length.out =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>## [1] 2.00 2.25 2.50 2.75 3.00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">times =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## [1] 1 2 1 2 1 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">each =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## [1] 1 1 1 2 2 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="dt">each =</span> <span class="dv">3</span>, <span class="dt">times =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;a&quot; &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot;</code></pre>
</div>
<div id="tehted-arvuliste-vektoritega" class="section level3">
<h3><span class="header-section-number">5.2.3</span> tehted arvuliste vektoritega</h3>
<p>Vektoreid saab liita, lahutada, korrutada ja jagada.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)
b &lt;-<span class="st"> </span><span class="dv">4</span> <span class="co">#ühe elemendiga vektor ei vaja c() enda ümber</span>
a <span class="op">+</span><span class="st"> </span>b</code></pre></div>
<pre><code>## [1] 5 6 7</code></pre>
<p>Kõik vektor a liikmed liideti arvuga 3 (kuna vektor b koosnes ühest liikmest, läks see kordusesse)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)
b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) 
a <span class="op">+</span><span class="st"> </span>b</code></pre></div>
<pre><code>## Warning in a + b: longer object length is not a multiple of shorter object
## length</code></pre>
<pre><code>## [1] 5 7 7</code></pre>
<p>Aga see töötab veateatega, sest vektorite pikkused ei ole üksteise kordajad 1 + 4; 2 + 5, 3 + 4</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)
b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>) 
a <span class="op">+</span><span class="st"> </span>b</code></pre></div>
<pre><code>## [1]  6  8  8 10</code></pre>
<p>see töötab: 1 + 5; 2 + 6; 3 + 5; 4 + 6</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)
b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>) 
a <span class="op">+</span><span class="st"> </span>b</code></pre></div>
<pre><code>## [1]  6  8 10 12</code></pre>
<p>Samuti see (ühepikkused vektorid — igat liiget kasutatakse üks kord)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)
<span class="kw">sum</span>(a)</code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(a)</code></pre></div>
<pre><code>## [1] 0.6666667</code></pre>
<p>Mis siin juhtus? R kodeerib sisemiselt TRUE kui 1 ja FALSE kui 0-i. summa 1 + 0 + 1 = 2. Seda loogiliste väärtuste omadust õpime varsti praktikas kasutama.</p>
</div>
<div id="list-andmekott" class="section level3">
<h3><span class="header-section-number">5.2.4</span> List – andmekott</h3>
<p>List on objektitüüp, kuhu saab koondada kõiki teisi objekte, kaasa arvatud listid. See on lihtsalt viis objektid koos hoida ühes suuremas meta-objektis. List on nagu jõuluvana kingikott, kus kommid, sokipaarid ja muud kingid kõik segamini loksuvad.</p>
<p>Näiteks siin list, kus loksuvad 1 vektor nimega a, 1 tibble nimega b ja 1 list nimega c, mis omakorda sisaldab vektorit nimega d ja tibblet nimega e. Seega on meil tegu rekursiivse listiga.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># numeric vector a</span>
a &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">5</span>)
<span class="co"># data.frame</span>
ab &lt;-<span class="st"> </span><span class="kw">data.frame</span>(a, <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>))
<span class="co"># linear model</span>
model &lt;-<span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>hp, <span class="dt">data =</span> mtcars)
<span class="co"># your grandma on bongos</span>
grandma &lt;-<span class="st"> &quot;your grandma on bongos&quot;</span>
<span class="co"># let&#39;s creat list</span>
happy_list &lt;-<span class="st"> </span><span class="kw">list</span>(a, ab, model, grandma)
happy_list</code></pre></div>
<pre><code>## [[1]]
## [1] 0.5949274 0.6216617 0.8306090 0.7624763 0.9948047
## 
## [[2]]
##           a          b
## 1 0.5949274 -0.4953961
## 2 0.6216617 -0.6551166
## 3 0.8306090 -2.0784799
## 4 0.7624763  0.1874438
## 5 0.9948047 -0.0646980
## 
## [[3]]
## 
## Call:
## lm(formula = mpg ~ hp, data = mtcars)
## 
## Coefficients:
## (Intercept)           hp  
##    30.09886     -0.06823  
## 
## 
## [[4]]
## [1] &quot;your grandma on bongos&quot;</code></pre>
<p>võtame listist välja elemndi “ab”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">happy_list<span class="op">$</span>ab</code></pre></div>
<pre><code>## NULL</code></pre>
</div>
</div>
<div id="tibble-ja-data-frame---andmeraamid" class="section level2">
<h2><span class="header-section-number">5.3</span> Tibble ja data frame - andmeraamid</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
<p>Andmeraam on eriline list, mis koosneb ühepikkustest vektoritest. Andmeraam on ühtlasi teatud liiki tabel, kus igas veerus on ainult ühte tüüpi andmed. Need vektorid ripuvad andmeraamis kõrvuti nagu tuulehaugid suitsuahjus, kusjuures vektori algus vastab tuulehaugi peale, mis on konksu otsas (konks vastab andmeraamis tulba nimele ja ühtlasi vektori nimele). Iga vektori nimi muutub sellises tabelis tulba nimeks. Igas tulbas saab olla ainult ühte tüüpi andmeid.</p>
<p>R-s on 2 andmeraami tüüpi: tibble ja data frame, mis on väga sarnased. Tibble on uuem, veidi kaunima väljatrükiga, pisut mugavam kasutada, ja me kasutame põhiliselt seda, välja arvatud hiljem Bayesi arvutustes, kus me tehnilistel põhjustel kasutame data frame. Tidyverse töötab tibblega veidi paremini kui data frame-ga, aga see vahe ei ole suur.</p>
<p>siin on meil 3 vektorit: shop, apples ja oranges, millest me paneme kokku tibble nimega fruits</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">shop &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;maxima&quot;</span>, <span class="st">&quot;tesco&quot;</span>, <span class="st">&quot;lidl&quot;</span>)
apples &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">43</span>)
oranges &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">32</span>, <span class="ot">NA</span>)
fruits &lt;-<span class="st"> </span><span class="kw">tibble</span>(shop, apples, oranges)
fruits</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##     shop apples oranges
##    &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 maxima      1       2
## 2  tesco      4      32
## 3   lidl     43      NA</code></pre>
<p>Siin ta on, ilusti meie workspace-s.</p>
<p><strong>Mõned asjad, mida tibblega (ja data framega) saab teha:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(fruits, apples)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   apples     n
##    &lt;dbl&gt; &lt;int&gt;
## 1      1     1
## 2      4     1
## 3     43     1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(fruits, shop)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     shop     n
##    &lt;chr&gt; &lt;int&gt;
## 1   lidl     1
## 2 maxima     1
## 3  tesco     1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fruits)</code></pre></div>
<pre><code>##      shop               apples        oranges    
##  Length:3           Min.   : 1.0   Min.   : 2.0  
##  Class :character   1st Qu.: 2.5   1st Qu.: 9.5  
##  Mode  :character   Median : 4.0   Median :17.0  
##                     Mean   :16.0   Mean   :17.0  
##                     3rd Qu.:23.5   3rd Qu.:24.5  
##                     Max.   :43.0   Max.   :32.0  
##                                    NA&#39;s   :1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(fruits)</code></pre></div>
<pre><code>## [1] &quot;shop&quot;    &quot;apples&quot;  &quot;oranges&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(fruits)</code></pre></div>
<pre><code>## [1] &quot;shop&quot;    &quot;apples&quot;  &quot;oranges&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(fruits)</code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ncol</span>(fruits)</code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(fruits, <span class="kw">desc</span>(apples)) <span class="co">#sorteerib tabeli veeru &quot;apples&quot; väärtuste järgi langevalt (default on tõusev sorteerimine). Võib argumendina anda mitu veergu.</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##     shop apples oranges
##    &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1   lidl     43      NA
## 2  tesco      4      32
## 3 maxima      1       2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">top_n</span>(fruits, <span class="dv">2</span>, apples) <span class="co">#saab 2 rida, milles on kõige rohkem õunu</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##    shop apples oranges
##   &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 tesco      4      32
## 2  lidl     43      NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">top_n</span>(fruits, <span class="op">-</span><span class="dv">2</span>, apples) <span class="co">#saab 2 rida, milles on kõige vähem õunu</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     shop apples oranges
##    &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 maxima      1       2
## 2  tesco      4      32</code></pre>
<p>Tibblega saab teha maatriksarvutusi, kui kasutada ainult arvudega ridu. <code>apply()</code> arvutab maatriksi rea (1) või veeru (2) kaupa, vastavalt funktsioonile, mille sa ette annad.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colSums</span>(fruits[ , <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</code></pre></div>
<pre><code>##  apples oranges 
##      48      NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rowSums</span>(fruits[ , <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</code></pre></div>
<pre><code>## [1]  3 36 NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rowMeans</span>(fruits[ , <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</code></pre></div>
<pre><code>## [1]  1.5 18.0   NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colMeans</span>(fruits[ , <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</code></pre></div>
<pre><code>##  apples oranges 
##      16      NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits_subset &lt;-<span class="st"> </span>fruits[ , <span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]
<span class="co"># 1 tähendab, et arvuta sd rea kaupa</span>
<span class="kw">apply</span>(fruits_subset, <span class="dv">1</span>, sd)</code></pre></div>
<pre><code>## [1]  0.7071068 19.7989899         NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 2 tähendab, et arvuta sd veeru kaupa</span>
<span class="kw">apply</span>(fruits_subset, <span class="dv">2</span>, sd) </code></pre></div>
<pre><code>##   apples  oranges 
## 23.43075       NA</code></pre>
<p>Lisame käsitsi meie tabelile 1 rea:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits &lt;-<span class="st"> </span><span class="kw">add_row</span>(fruits, 
                  <span class="dt">shop =</span> <span class="st">&quot;konsum&quot;</span>, 
                  <span class="dt">apples =</span> <span class="dv">132</span>, 
                  <span class="dt">oranges =</span> <span class="op">-</span><span class="dv">5</span>, 
                  <span class="dt">.before =</span> <span class="dv">3</span>)
fruits</code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     shop apples oranges
##    &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 maxima      1       2
## 2  tesco      4      32
## 3 konsum    132      -5
## 4   lidl     43      NA</code></pre>
<p>proovi ise:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">add_column</span>()</code></pre></div>
<p>Eelnevaid verbe ei kasuta me vist enam kunagi sest tavaliselt loeme me andmed sisse väljaspoolt R-i. Aga väga kasulikud on järgmised käsud:</p>
<div id="rekodeerime-tibble-vaartusi" class="section level4">
<h4><span class="header-section-number">5.3.0.1</span> rekodeerime tibble väärtusi</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits<span class="op">$</span>apples[fruits<span class="op">$</span>apples<span class="op">==</span><span class="dv">43</span>] &lt;-<span class="st"> </span><span class="dv">333</span>
fruits</code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     shop apples oranges
##    &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 maxima      1       2
## 2  tesco      4      32
## 3 konsum    132      -5
## 4   lidl    333      NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits<span class="op">$</span>shop[fruits<span class="op">$</span>shop<span class="op">==</span><span class="st">&quot;tesco&quot;</span>] &lt;-<span class="st"> &quot;TESCO&quot;</span>
fruits</code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     shop apples oranges
##    &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 maxima      1       2
## 2  TESCO      4      32
## 3 konsum    132      -5
## 4   lidl    333      NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits<span class="op">$</span>apples[fruits<span class="op">$</span>apples<span class="op">&gt;</span><span class="dv">100</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
fruits</code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     shop apples oranges
##    &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1 maxima      1       2
## 2  TESCO      4      32
## 3 konsum     NA      -5
## 4   lidl     NA      NA</code></pre>
<p>Remove duplicate rows where specific column (col1) contains duplicated values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">distinct</span>(dat, col1, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>)
<span class="co"># kõikide col vastu</span>
<span class="kw">distinct</span>(dat) </code></pre></div>
<p>Rekodeerime Inf ja NA väärtused nulliks (väga halb mõte):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># inf to 0</span>
x[<span class="kw">is.infinite</span>(x)] &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="co"># NA to 0</span>
x[<span class="kw">is.na</span>(x)] &lt;-<span class="st"> </span><span class="dv">0</span></code></pre></div>
</div>
<div id="uhendame-kaks-tibblet-rea-kaupa" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Ühendame kaks tibblet rea kaupa</h3>
<p>Tabeli veergude arv ei muutu, ridade arv kasvab.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">colA =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="dt">colB =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))
df1.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">colA =</span> <span class="st">&quot;d&quot;</span>, <span class="dt">colB =</span>  <span class="dv">4</span>)
<span class="co">#id teeb veel ühe veeru, mis näitab, kummast algtabelist iga uue tabeli rida pärit on </span>
<span class="kw">bind_rows</span>(df1, df1.<span class="dv">1</span>, <span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 3
##      id  colA  colB
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
## 1     1     a     1
## 2     1     b     2
## 3     1     c     3
## 4     2     d     4</code></pre>
<p>Vaata Environmendist need tabelid üle ja mõtle järgi, mis juhtus.</p>
<p>Kui <code>bind_rows()</code> miskipärast ei tööta, proovi <code>rbind()</code> funktsiooni, mis on väga sarnane (?rbind). NB! Alati kontrollige, et ühendatud tabel oleks selline, nagu te tahtsite!</p>
<p>Näiteks, võib-olla te tahtsite järgnevat tabelit saada, aga võib-olla ka mitte:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ColC=</span><span class="st">&quot;d&quot;</span>, <span class="dt">ColD=</span><span class="dv">4</span>)
<span class="kw">bind_rows</span>(df1, df2) <span class="co">#works by guessing your true intention</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##    colA  colB  ColC  ColD
##   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
## 1     a     1  &lt;NA&gt;    NA
## 2     b     2  &lt;NA&gt;    NA
## 3     c     3  &lt;NA&gt;    NA
## 4  &lt;NA&gt;    NA     d     4</code></pre>
<div id="uhendame-kaks-tibblet-veeru-kaupa" class="section level4">
<h4><span class="header-section-number">5.3.1.1</span> ühendame kaks tibblet veeru kaupa</h4>
<p>Meil on 2 verbi: bind_cols ja cbind, millest esimene on konservatiivsem. Proovige eelkõige bind_col-ga läbi saada, aga kui muidu ei saa, siis cbind ühendab vahest asju, mida bind_cols keeldub puutumast. NB! Alati kontrollige, et ühendatud tabel oleks selline, nagu te tahtsite!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfx &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">colC=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>))
<span class="kw">cbind</span>(df1, dfx)</code></pre></div>
<pre><code>##   colA colB colC
## 1    a    1    4
## 2    b    2    5
## 3    c    3    6</code></pre>
</div>
<div id="nii-saab-tibblest-katte-vektori-millega-saab-tehteid-teha." class="section level4">
<h4><span class="header-section-number">5.3.1.2</span> Nii saab tibblest kätte vektori, millega saab tehteid teha.</h4>
<p>Tibble jääb muidugi endisel kujul alles.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ubinad &lt;-<span class="st"> </span>fruits<span class="op">$</span>apples
ubinad &lt;-<span class="st"> </span>ubinad <span class="op">+</span><span class="st"> </span><span class="dv">2</span>
ubinad</code></pre></div>
<pre><code>## [1]  3  6 NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(ubinad) <span class="co">#see on jälle vektor</span></code></pre></div>
<pre><code>##  num [1:4] 3 6 NA NA</code></pre>
</div>
</div>
<div id="andmeraamide-salvestamine-eksport-import" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Andmeraamide salvestamine (eksport-import)</h3>
<p>Andmeraami saame salvestada näiteks csv-na (comma separated file) oma kõvakettale</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(fruits, <span class="st">&quot;data/fruits.csv&quot;</span>)</code></pre></div>
<p>Kuhu see fail läks? See läks meie projekti juurkataloogi kausta “data”, mille leiame käsuga:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getwd</span>()</code></pre></div>
<pre><code>## [1] &quot;/Users/taavi/Dropbox/2017-R-course/lectures&quot;</code></pre>
<p>Andmete sisselugemine töökataloogist:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits &lt;-<span class="st">  </span><span class="kw">read_csv</span>(<span class="st">&quot;data/fruits.csv&quot;</span>)</code></pre></div>
<p>Excelist csv-na eksporditud failid tuleks sisse lugeda käsuga <code>read_csv2</code> või <code>read.csv2</code> (need on erinevad funktsioonid; read.csv2 loeb selle sisse data framena ja read_csv2 tibble-na).</p>
<p>R-i saab sisse lugeda palju erinevaid andmeformaate, kaasa arvatud Exceli oma. installi: Gotta read em all R. See läheb ülesse tab-i Addins. Sealt saab selle avada ja selle abil tabeleid oma workspace üles laadida.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install gotta read em all as R studio addin</span>
<span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;Stan125/GREA&quot;</span>)</code></pre></div>
<p>Alternatiiv: mine alla paremake Files tab-le, navigeeri sinna kuhu vaja ja kliki faili nimele, mida tahad R-i importida.</p>
<p>Mõlemal juhul ilmub alla konsooli (all vasakul) koodijupp, mille jooksutamine peaks asja ära tegema. Te võite tahta selle koodi kopeerida üles vasakusse aknasse kus teie ülejäänud kood tulevastele põlvedele säilub.</p>
<blockquote>
<p>Tüüpiliselt töötate R-s oma algse andmestikuga. Reprodutseeruvaks projektiks on vaja 2 asja: algandmeid ja koodi, millega neid manipuleerida.</p>
</blockquote>
<p>NB! R ei muuda algandmeid, mille te näiteks csv-na sisse loete - need jäävad alati neitsilikeks.</p>
<p>Seega ei ole andmetabelite salvestamine töö vaheproduktidena sageli vajalik sest te jooksutate iga kord, kui te oma projekti juurde naasete, kogu analüüsi uuesti kuni kohani, kuhu te pooleli jäite. See tagab kõige paremini, et teie kood töötab tervikuna. Erandiks on tabelid, mille arvutamine palju aega võtab.</p>
<p>Tibble konverteerimine data frame-ks ja tagasi tibbleks:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(fruits)</code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(fruits)
<span class="kw">class</span>(fruits)</code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(fruits)
<span class="kw">class</span>(fruits)</code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
</div>
</div>
<div id="tabelit-sisse-lugedes-vaata-ule-na-d" class="section level2">
<h2><span class="header-section-number">5.4</span> tabelit sisse lugedes vaata üle NA-d</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(VIM) </code></pre></div>
<pre><code>## Loading required package: colorspace</code></pre>
<pre><code>## Loading required package: grid</code></pre>
<pre><code>## Loading required package: data.table</code></pre>
<pre><code>## 
## Attaching package: &#39;data.table&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     between, first, last</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     transpose</code></pre>
<pre><code>## VIM is ready to use. 
##  Since version 4.0.0 the GUI is in its own package VIMGUI.
## 
##           Please use the package to use the new (and old) GUI.</code></pre>
<pre><code>## Suggestions and bug-reports can be submitted at: https://github.com/alexkowa/VIM/issues</code></pre>
<pre><code>## 
## Attaching package: &#39;VIM&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:datasets&#39;:
## 
##     sleep</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diabetes &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> <span class="st">&quot;data/diabetes.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">dec =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)
<span class="kw">str</span>(diabetes)</code></pre></div>
<pre><code>## &#39;data.frame&#39;:    403 obs. of  19 variables:
##  $ id      : int  1000 1001 1002 1003 1005 1008 1011 1015 1016 1022 ...
##  $ chol    : int  203 165 228 78 249 248 195 227 177 263 ...
##  $ stab.glu: int  82 97 92 93 90 94 92 75 87 89 ...
##  $ hdl     : int  56 24 37 12 28 69 41 44 49 40 ...
##  $ ratio   : num  3.6 6.9 6.2 6.5 8.9 ...
##  $ glyhb   : num  4.31 4.44 4.64 4.63 7.72 ...
##  $ location: Factor w/ 2 levels &quot;Buckingham&quot;,&quot;Louisa&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ age     : int  46 29 58 67 64 34 30 37 45 55 ...
##  $ gender  : Factor w/ 2 levels &quot;female&quot;,&quot;male&quot;: 1 1 1 2 2 2 2 2 2 1 ...
##  $ height  : int  62 64 61 67 68 71 69 59 69 63 ...
##  $ weight  : int  121 218 256 119 183 190 191 170 166 202 ...
##  $ frame   : Factor w/ 4 levels &quot;&quot;,&quot;large&quot;,&quot;medium&quot;,..: 3 2 2 2 3 2 3 3 2 4 ...
##  $ bp.1s   : int  118 112 190 110 138 132 161 NA 160 108 ...
##  $ bp.1d   : int  59 68 92 50 80 86 112 NA 80 72 ...
##  $ bp.2s   : int  NA NA 185 NA NA NA 161 NA 128 NA ...
##  $ bp.2d   : int  NA NA 92 NA NA NA 112 NA 86 NA ...
##  $ waist   : int  29 46 49 33 44 36 46 34 34 45 ...
##  $ hip     : int  38 48 57 38 41 42 49 39 40 50 ...
##  $ time.ppn: int  720 360 180 480 300 195 720 1020 300 240 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">aggr</span>(diabetes, <span class="dt">prop=</span><span class="ot">FALSE</span>, <span class="dt">numbers=</span>T)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-54-1.png" width="672" /> Siit on näha, et kui me viskame välja 2 tulpa ja seejärel kõik read, mis sisaldavad NA-sid, kaotame me u 20 rida 380-st, mis ei ole suur kaotus.</p>
<p>Kui palju ridu, milles on 0 NA-d? Mitu % kõikidest ridadest?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nrows &lt;-<span class="st"> </span><span class="kw">nrow</span>(diabetes)
  ncomplete &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">complete.cases</span>(diabetes))
  ncomplete <span class="co">#136</span></code></pre></div>
<pre><code>## [1] 136</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  ncomplete<span class="op">/</span>nrows <span class="co">#34%</span></code></pre></div>
<pre><code>## [1] 0.337469</code></pre>
<p>Mitu NA-d igas tulbas?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">sapply</span>(diabetes, <span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">is.na</span>(x))) </code></pre></div>
<pre><code>##       id     chol stab.glu      hdl    ratio    glyhb location      age 
##        0        1        0        1        1       13        0        0 
##   gender   height   weight    frame    bp.1s    bp.1d    bp.2s    bp.2d 
##        0        5        1        0        5        5      262      262 
##    waist      hip time.ppn 
##        2        2        3</code></pre>
<p>ploti NAd punasega igale tabeli reale ja tulbale mida tumedam halli toon seda suurem number selle tulba kontekstis</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">VIM<span class="op">::</span><span class="kw">matrixplot</span>(diabetes) </code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<pre><code>## 
## Click in a column to sort by the corresponding variable.
## To regain use of the VIM GUI and the R console, click outside the plot region.</code></pre>
<p>kuidas rekodeerida NA-d näiteks 0-ks</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df[<span class="kw">is.na</span>(df)] &lt;-<span class="st"> </span><span class="dv">0</span>
df[<span class="kw">is.na</span>(df)] &lt;-<span class="st"> &quot;other&quot;</span>
df[df <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co">#teeb vastupidi 0-d NA-deks</span></code></pre></div>
<p>Pane tähele, et NA tähistamine ei käi character vectorina vaid dedikeeritud is.na() funktsiooniga.</p>
<div id="matrix---numbriraam" class="section level3">
<h3><span class="header-section-number">5.4.1</span> 4. Matrix - numbriraam</h3>
<p>Maatriks koosneb ühepikkustest vektoritest, mis sisaldavad ainult numbreid. Enamasti me ei kasuta maatrikseid, vaid andmeraame. Tip: me saame sageli andmeraami maatriksina kasutada kui me viskame sealt välja mitte-numbrilised tulbad.</p>
<p>Aga saame ka andmeraame konverteerida otse maatriksiks (ja tagasi). Vahest läheb seda vaja, eriti bioconductori funktsioonidega.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fruits &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(fruits)
<span class="kw">class</span>(fruits)</code></pre></div>
</div>
</div>
<div id="andmete-tuubid" class="section level2">
<h2><span class="header-section-number">5.5</span> Andmete tüübid</h2>
<ul>
<li>numeric / integer</li>
<li>logical -2 väärtust TRUE/FALSE</li>
<li>character</li>
<li>factor (ordered and unordered) - 2+ diskreetset väärtust, mis võivad olla järjestatud suuremast väiksemani (aga ei asu üksteisest võrdsel kaugusel). Faktoreid käsitleme põhjalikumalt hiljem.</li>
</ul>
<p>Andmete tüüpe saab üksteiseks konverteerida as.factor(), as.numeric(), as.character(), as.integer(), as.logical()</p>
</div>
<div id="indekseerimine" class="section level2">
<h2><span class="header-section-number">5.6</span> Indekseerimine</h2>
<p>Igale vektori, listi, andmeraami ja maatriksi elemendile vastab unikaalne postiindeks, mille abil saame just selle elemendi unikaalselt indentifitseerida, välja võtta ja töödelda.</p>
<p>Seega on indeksi mõte väga lühikese käsuga välja võtta R-i objektide üksikuid elemente.</p>
<p>R-s algab indeksi numeratsioon 1-st (mitte 0-st, nagu Pythonis).</p>
<div id="vektorid-ja-nende-indeksid-on-uhe-dimensionaalsed" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Vektorid ja nende indeksid on ühe-dimensionaalsed</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vector &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">:</span><span class="dv">5</span> 
my_vector</code></pre></div>
<pre><code>## [1] 2 3 4 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vector[<span class="dv">1</span>] <span class="co">#1. element ehk number 2</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vector[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)] <span class="co">#1. ja 3. element </span></code></pre></div>
<pre><code>## [1] 2 4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vector[<span class="op">-</span><span class="dv">1</span>] <span class="co">#kõik elemendid, v.a. element number 1</span></code></pre></div>
<pre><code>## [1] 3 4 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vector[<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">3</span>)] <span class="co">#kõik elemendid, v.a. element number 1 ja 3</span></code></pre></div>
<pre><code>## [1] 3 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vector[<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>] <span class="co">#elemendid 3, 4 ja 5 (element 5 on määramata, seega NA)</span></code></pre></div>
<pre><code>## [1]  4  5 NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_vector[<span class="op">-</span>(<span class="dv">3</span><span class="op">:</span><span class="kw">length</span>(my_vector))] <span class="co">#1. ja 2. element</span></code></pre></div>
<pre><code>## [1] 2 3</code></pre>
</div>
<div id="andmeraamid-ja-maatriksid-on-kahe-dimensionaalsed-nagu-ka-nende-indeksid" class="section level3">
<h3><span class="header-section-number">5.6.2</span> andmeraamid ja maatriksid on kahe-dimensionaalsed, nagu ka nende indeksid</h3>
<p><strong>2D indeksi kuju on [rea_indeks, veeru_indeks]</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">colA =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="dt">colB =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))
dat
<span class="co"># üks andmepunkt: 1 rida, 2. veerg</span>
dat[<span class="dv">1</span>, <span class="dv">2</span>]
<span class="co"># 1. rida, kõik veerud</span>
dat[<span class="dv">1</span>, ]
<span class="co"># 2. veerg, kõik read</span>
dat[, <span class="dv">2</span>]
<span class="co"># kõik read peale 1.</span>
dat[<span class="op">-</span><span class="dv">1</span>, ]
<span class="co"># viskab välja 2. veeru</span>
dat[, <span class="op">-</span><span class="dv">2</span>]
<span class="co"># 2 andmepunkti: 2. rida, 1. ja 2. veerg</span>
dat[<span class="dv">2</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]
<span class="co"># 2 andmepunkti: 2. rida, 3. ja 4. veerg</span>
dat[<span class="dv">2</span>, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)]
<span class="co">#viskab välja 1. ja 2. rea</span>
dat[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), ]
<span class="co">#veerg nimega colB, output on erandina vektor!</span>
dat<span class="op">$</span>colB</code></pre></div>
<p>Kui me indekseerimisega tibblest veeru ehk vektori välja võtame, on output class: tibble. Kui me teeme sama data frame-st, siis on output class: vector.</p>
<p>Nüüd veidi keerulisemad konstruktsioonid, mis võimaldavad tabeli ühe kindla veeru väärtusi välja tõmmata teise veeru väärtuste järgi filteerides. Püüdke sellest koodist aru saada, et te hiljem ära tunneksite, kui midagi sellist vastu tuleb. Õnneks ei ole teil endil vaja sellist koodi kirjutada, me õpetame teile varsti lihtsama filtri meetodi.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">colA =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="dt">colB =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))
dat<span class="op">$</span>colB[dat<span class="op">$</span>colA <span class="op">!=</span><span class="st"> &quot;a&quot;</span> ] <span class="co">#jätab sisse kõik vektori colB väärtused, kus samas tabeli reas olev colA väärtus ei ole &quot;a&quot;. output on vektor! </span></code></pre></div>
<pre><code>## [1] 2 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat<span class="op">$</span>colA[dat<span class="op">$</span>colB <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>] <span class="co">#jätab sisse kõik vektori colA väärtused, kus samas tabeli reas olev colB väärtus &gt;1. output on vektor. </span></code></pre></div>
<pre><code>## [1] &quot;b&quot; &quot;c&quot;</code></pre>
</div>
<div id="litside-indeksid-on-kolme-dimensionaalsed" class="section level3">
<h3><span class="header-section-number">5.6.3</span> litside indeksid on kolme-dimensionaalsed</h3>
<p><strong>Listi indekseerimisel kasutame kahte sorti nurksulge, [ ] ja [[ ]], mis töötavad erinevalt</strong>.</p>
<p>Kui listi vaadata nagu objektide vanglat, siis kaksiksulgude [[ ]] abil on võimalik üksikuid objekte vanglast välja päästa nii, et taastub nende algne kuju ehk class. (Vorm list_name$object_name töötab samamoodi kui kaksiksulud.) Seevastu üksiksulud [ ] tekitavad uue listi, kus on säilinud osad algse listi elemendid, ehk uue vangla vähemate vangidega.</p>
<blockquote>
<p>Kaksiksulud [[ ]] päästavad listist välja ühe elemendi ja taastavad selle algse class-i (data.frame, vektor, list jms); Üksiksulud [ ] võtavad algsest listist välja teie poolt valitud elemendid aga jätavad uue objekti ikka listi kujule.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="kw">tibble</span>(<span class="dt">colA=</span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">colB=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)), <span class="dt">b=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="ot">NA</span>, <span class="st">&quot;s&quot;</span>))
<span class="co">#this list has two elements, a df called &quot;a&quot; and a character vector called &quot;b&quot;.</span>
<span class="kw">str</span>(my_list)</code></pre></div>
<pre><code>## List of 2
##  $ a:Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:   2 obs. of  2 variables:
##   ..$ colA: chr [1:2] &quot;A&quot; &quot;B&quot;
##   ..$ colB: num [1:2] 1 2
##  $ b: chr [1:3] &quot;1&quot; NA &quot;s&quot;</code></pre>
<p>Tõmbame listist välja tibble</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_tibble &lt;-<span class="st"> </span>my_list[[<span class="dv">1</span>]] <span class="co">#class is df  --- we extracted a df from the list</span>
my_tibble</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##    colA  colB
##   &lt;chr&gt; &lt;dbl&gt;
## 1     A     1
## 2     B     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#my_list$a #sama asi: $ does the same thing as [[ ]]</span></code></pre></div>
<p>See ei ole enam list</p>
<p>Nüüd võtame üksiksuluga listist välja 1. elemendi, mis on tibble, aga output ei ole mitte tibble, vaid ikka list. Seekord ühe elemendiga, mis on tibble.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aa &lt;-<span class="st"> </span>my_list[<span class="dv">1</span>]
<span class="kw">str</span>(aa)</code></pre></div>
<pre><code>## List of 1
##  $ a:Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:   2 obs. of  2 variables:
##   ..$ colA: chr [1:2] &quot;A&quot; &quot;B&quot;
##   ..$ colB: num [1:2] 1 2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aa1 &lt;-<span class="st"> </span>my_list<span class="op">$</span>a[<span class="dv">2</span>,] <span class="co">#class is df</span>
aa1</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    colA  colB
##   &lt;chr&gt; &lt;dbl&gt;
## 1     B     2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">aa3 &lt;-<span class="st"> </span>my_list[[<span class="dv">1</span>]][<span class="dv">1</span>,]
aa3</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    colA  colB
##   &lt;chr&gt; &lt;dbl&gt;
## 1     A     1</code></pre>
<p>Kõigepealt läksime kaksiksulgudega listi taseme võrra sisse ja võtsime välja objekti my_list 1. elemendi, tema algses tibble formaadis, (indeksi 1. dimensioon). Seejärel korjame sealt välja 1. rea, tibble formaati muutmata ja seega üksiksulgudes (indeksi 2. ja 3. dimensioon).</p>
<p>Pane tähele, et [[ ]] lubab ainult ühe elemendi korraga listist välja päästa.</p>
</div>
</div>
<div id="regular-expression-ja-find-replace" class="section level2">
<h2><span class="header-section-number">5.7</span> Regular expression ja find &amp; replace</h2>
<p>Regular expression annab võimaluse lühidalt kirjeldada mitte-üheseid otsinguparameetreid.</p>
<blockquote>
<p>regular expression on string, mis kirjeldab mitut stringi</p>
</blockquote>
<p>A <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html">regular expression</a> <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html">Regular Expressions as used in R</a></p>
<ul>
<li>Most characters, including all letters and digits, are regular expressions that match themselves.</li>
<li><code>.</code> matches any single character.</li>
<li>You can refer also to a character class, which is a list of characters enclosed between <code>[</code> and <code>]</code>, e.g. <code>[[:alnum:]]</code> is same as <code>[A-z0-9]</code>.</li>
<li>Most common character classes:
<ul>
<li><code>[:alnum:]</code> includes alphanumerics (<code>[:alpha:]</code> and <code>[:digit:]</code>);</li>
<li><code>[:alpha:]</code>, includes alphabetic characters (<code>[:upper:]</code> and <code>[:lower:]</code> case);</li>
<li><code>[:punct:]</code> includes punctuation characters ! &quot; # $ % &amp; ’ ( ) * + , - . / : ; &lt; = &gt; ? @ [  ] ^ _ ` ` { | } ~.;</li>
<li><code>[:blank:]</code> includes space and tab; etc.</li>
</ul></li>
<li>The metacharacters in regular expressions are <code>. \ | ( ) [ { ^ $ * + ?</code>, whether these have a special meaning depends on the context. When matching a metacharacter as a regular character, precede it with a double backslash <code>\\</code>.</li>
<li>Repetition quantifiers put after regex specify how many times regex is matched: <code>?</code>, optional, at most once; <code>*</code>, zero or more times; <code>+</code>, one or more times; <code>{n}</code>, n times; <code>{n,}</code>, n or more times; <code>{n,m}</code>, n to m times.</li>
<li>^ anchors the regular expression to the start of the string.</li>
<li>$ anchors the the regular expression to end of the string.</li>
</ul>
<div id="common-operations-with-regular-expressions" class="section level4">
<h4><span class="header-section-number">5.7.0.1</span> Common operations with regular expressions</h4>
<ul>
<li>Locate a pattern match (positions)</li>
<li>Extract a matched pattern</li>
<li>Identify a match to a pattern</li>
<li>Replace a matched pattern</li>
</ul>
</div>
<div id="find-and-replace" class="section level4">
<h4><span class="header-section-number">5.7.0.2</span> Find and replace</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
x&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;ananas&quot;</span>, <span class="st">&quot;banana&quot;</span>)

<span class="co">#replaces all a-s at the beginning of strings with e-s</span>
<span class="kw">str_replace</span>(x, <span class="st">&quot;^a&quot;</span>, <span class="st">&quot;e&quot;</span>) </code></pre></div>
<pre><code>## [1] &quot;epple&quot;  &quot;enanas&quot; &quot;banana&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># str_replace only replaces at the first occurence at each string</span>
<span class="kw">str_replace</span>(x, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;e&quot;</span>) </code></pre></div>
<pre><code>## [1] &quot;epple&quot;  &quot;enanas&quot; &quot;benana&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#str_replace_all replaces all a-s anywhere in the strings</span>
<span class="kw">str_replace_all</span>(x, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;e&quot;</span>) </code></pre></div>
<pre><code>## [1] &quot;epple&quot;  &quot;enenes&quot; &quot;benene&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#replaces a and the following character at the end of string with nothing (i.e. deletes 2 chars)</span>
<span class="kw">str_replace</span>(x, <span class="st">&quot;a.$&quot;</span>, <span class="st">&quot;&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;apple&quot;  &quot;anan&quot;   &quot;banana&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#replaces a-s or s-s at the end of string with e-s</span>
<span class="kw">str_replace</span>(x, <span class="st">&quot;(a|s)$&quot;</span>, <span class="st">&quot;e&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;apple&quot;  &quot;ananae&quot; &quot;banane&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#replaces a-s or s-s anywhere in the string with e-s</span>
<span class="kw">str_replace_all</span>(x, <span class="st">&quot;a|s&quot;</span>, <span class="st">&quot;e&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;epple&quot;  &quot;enenee&quot; &quot;benene&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#remove all numbers. </span>
y&lt;-<span class="kw">c</span>(<span class="st">&quot;as1&quot;</span>, <span class="st">&quot;2we3w&quot;</span>, <span class="st">&quot;3e&quot;</span>)
<span class="kw">str_replace_all</span>(y, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d&quot;</span>, <span class="st">&quot;&quot;</span>) </code></pre></div>
<pre><code>## [1] &quot;as&quot;  &quot;wew&quot; &quot;e&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#remove everything, except numbers. </span>
<span class="kw">str_replace_all</span>(y, <span class="st">&quot;[A-Za-z_]&quot;</span>, <span class="st">&quot;&quot;</span>) </code></pre></div>
<pre><code>## [1] &quot;1&quot;  &quot;23&quot; &quot;3&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;apple pie&quot;</span>)
<span class="kw">str_replace_all</span>(x, <span class="st">&quot;^apple$&quot;</span>,<span class="st">&quot;m&quot;</span>) <span class="co">#To force to only match a complete string:</span></code></pre></div>
<pre><code>## [1] &quot;m&quot;         &quot;apple pie&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_replace_all</span>(x, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">s&quot;</span>,<span class="st">&quot;_&quot;</span>) <span class="co">#space to _</span></code></pre></div>
<pre><code>## [1] &quot;apple&quot;     &quot;apple_pie&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_replace_all</span>(x, <span class="st">&quot;[apl]&quot;</span>,<span class="st">&quot;_&quot;</span>) <span class="co">#a or p or l to _</span></code></pre></div>
<pre><code>## [1] &quot;____e&quot;     &quot;____e _ie&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str_replace_all</span>(x, <span class="st">&quot;[ap|p.e]&quot;</span>,<span class="st">&quot;_&quot;</span>) <span class="co"># ap or p.e to _</span></code></pre></div>
<pre><code>## [1] &quot;___l_&quot;     &quot;___l_ _i_&quot;</code></pre>
<p><strong>patterns that match more than one character:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">. (dot)<span class="op">:</span><span class="st"> </span>any character apart from a newline.

\\d<span class="op">:</span><span class="st"> </span>any digit.

\\s<span class="op">:</span><span class="st"> </span>any <span class="kw">whitespace</span> (space, tab, newline).

\[abc]<span class="op">:</span><span class="st"> </span>match a, b, or c.

\[<span class="op">!</span>abc]<span class="op">:</span><span class="st"> </span>match anything except a, b, or c.

To create a regular expression containing \d or \s, you???ll need to escape the \ <span class="cf">for</span> the string, so you will type <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">d&quot;</span> or <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">s&quot;</span>.

abc<span class="op">|</span>d..f will match either <span class="st">&quot;abc&quot;</span>, or <span class="st">&quot;deaf&quot;</span>. </code></pre></div>
</div>
</div>
<div id="tidyverse" class="section level2">
<h2><span class="header-section-number">5.8</span> Tidyverse</h2>
<p>Tidyverse on väike osa R-i ökosüsteemist, kus kehtivad omad reeglid. Tidyverse raamatukogud lähtuvad ühtsest filosoofiast ja töötavad hästi koos. Tidyverse algab andmetabeli struktuurist ja selle funktsioonid võtavad reeglina sisse õige struktuuriga tibble ja väljastavad samuti tibble, mis sobib hästi järgmise tidyverse funktsiooni sisendiks. Seega on tidyverse hästi sobiv läbi torude %&gt;% laskmiseks. Tidyversiga sobib hästi kokku ka ggplot2 graafikasüsteem.</p>
<div id="tidy-tabeli-struktuur" class="section level3">
<h3><span class="header-section-number">5.8.1</span> Tidy tabeli struktuur</h3>
<ul>
<li><strong>väärtus</strong> (<em>value</em>) — ühe mõõtmise tulemus (183 cm)</li>
<li><strong>muutuja</strong> (<em>variable</em>) — see, mida sa mõõdad (pikkus) või faktor (sex)</li>
<li><strong>andmepunkt</strong> (<em>observation</em>) — väärtused, mis mõõdeti samal katsetingimusel (1. subjekti pikkus ja kaal 3h ajapunktis)</li>
<li><strong>vaatlusühik</strong> (<em>unit of measurement</em>) — keda mõõdeti (subjekt nr 1)</li>
<li><strong>vaatlusühiku tüüp</strong> — inimene, hiir, jt</li>
</ul>
<blockquote>
<p>vaatlusühiku tüüp = tabel</p>
</blockquote>
<blockquote>
<p>muutuja = veerg</p>
</blockquote>
<blockquote>
<p>andmepunkt = rida</p>
</blockquote>
<blockquote>
<p>vaatlusühikute koodid on kõik koos ühes veerus</p>
</blockquote>
<p>Veergude järjekord tabelis on 1. vaatlusühik, 2. faktor, mis annab katse-kontrolli erisuse, 3. kõik see, mida otse ei mõõdetud (sex, batch nr, etc.), 4. numbritega veerud (iga muutuja kohta üks veerg)</p>
<pre><code>## # A tibble: 2 x 6
##   subject    drug   sex  time length weigth
##     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1       1     exp     F     3    168     88
## 2       2 placebo     M     3    176     91</code></pre>
<p>Nii näeb välja tidy tibble. Kõik analüüsil vajalikud parameetrid tuleks siia tabelisse veeru kaupa sisse tuua. Näiteks, kui mõõtmised on sooritatud erinevates keskustes erinevate inimeste poolt kasutades sama ravimi erinevaid preparaate, oleks hea siia veel 3 veergu lisada (center, experimenter, batch).</p>
</div>
<div id="tabeli-dimensioonide-muutmine-pikk-ja-lai-formaat" class="section level3">
<h3><span class="header-section-number">5.8.2</span> Tabeli dimensioonide muutmine (pikk ja lai formaat)</h3>
<p>Väga oluline osa tidyverses töötamisest on tabelite pika ja laia formaadi vahel viimine.</p>
<p>See on laias formaadis tabel df, mis ei ole tidy</p>
<pre><code>## # A tibble: 3 x 5
##   subject   sex control experiment_1 experiment_2
##     &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1     Tim     M      23           34           40
## 2     Ann     F      31           38           42
## 3    Jill     F      30           36           44</code></pre>
<p>Kõigepealt pikka formaati. key ja value argumendid on ainult uute veergude nimetamiseks, oluline on 3:ncol(dat) argument, mis ütleb, et “kogu kokku veerud alates 3. veerust”. Alternatiivne viis seda öelda: c(-subject, -sex).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_lng &lt;-<span class="st"> </span><span class="kw">gather</span>(dat, <span class="dt">key =</span> experiment, <span class="dt">value =</span> value, <span class="dv">3</span><span class="op">:</span><span class="kw">ncol</span>(dat))
<span class="co"># df_l3&lt;-df %&gt;% gather(experiment, value, 3:ncol(df)) works as well.</span>
<span class="co">#df_l4&lt;-df %&gt;% gather(experiment, value, c(-subject, -sex)) works as well</span>
dat_lng</code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject   sex   experiment value
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;
## 1     Tim     M      control    23
## 2     Ann     F      control    31
## 3    Jill     F      control    30
## 4     Tim     M experiment_1    34
## 5     Ann     F experiment_1    38
## 6    Jill     F experiment_1    36
## 7     Tim     M experiment_2    40
## 8     Ann     F experiment_2    42
## 9    Jill     F experiment_2    44</code></pre>
<p>Paneme selle tagasi algsesse laia formaati: ?spread</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">spread</span>(dat_lng, <span class="dt">key =</span> experiment, <span class="dt">value =</span> value)</code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   subject   sex control experiment_1 experiment_2
## *   &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
## 1     Ann     F      31           38           42
## 2    Jill     F      30           36           44
## 3     Tim     M      23           34           40</code></pre>
<p>key viitab pika tabeli veerule, mille väärtustest tulevad laias tabelis uute veergude nimed. value viitab pika tabeli veerule, kust võetakse arvud, mis uues laias tabelis uute veergude vahel laiali jagatakse.</p>
<div id="tibble-transpose-read-veergudeks-ja-vastupidi" class="section level4">
<h4><span class="header-section-number">5.8.2.1</span> Tibble transpose — read veergudeks ja vastupidi</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">a =</span> <span class="kw">c</span>(<span class="st">&quot;tim&quot;</span>, <span class="st">&quot;tom&quot;</span>, <span class="st">&quot;jill&quot;</span>), <span class="dt">b1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">b2 =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>))
dat</code></pre></div>
<pre><code>## # A tibble: 3 x 3
##       a    b1    b2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1   tim     1     4
## 2   tom     2     5
## 3  jill     3     6</code></pre>
<p>Me kasutame selleks maatriksarvutuse funktsiooni t() — transpose. See võtab sisse ainult numbrilisi veerge, seega anname talle ette df miinus 1. veerg, mille sisu me konverteerime uue tablei veerunimedeks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">t</span>(dat[,<span class="op">-</span><span class="dv">1</span>])
<span class="kw">colnames</span>(dat1) &lt;-<span class="st"> </span>dat<span class="op">$</span>a
dat1</code></pre></div>
<pre><code>##    tim tom jill
## b1   1   2    3
## b2   4   5    6</code></pre>
</div>
</div>
</div>
<div id="dplyr-i-5-verbi" class="section level2">
<h2><span class="header-section-number">5.9</span> dplyr-i 5 verbi</h2>
<p>Need tuleb teil omale pähe ajada sest nende 5 verbiga (pluss gather ja spread) saab lihtsalt teha 90% andmeväänamisest, mida teil elus vaja läheb. NB! Check the data wrangling cheatsheet and dplyr help for further details. dplyr laetakse koos tidyverse-ga automaatselt teie workspace.</p>
<div id="select-columns" class="section level3">
<h3><span class="header-section-number">5.9.1</span> <code>select()</code> columns</h3>
<p><code>select()</code> selects, renames, and re-orders columns.</p>
<p>Select columns from sex to value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris
<span class="kw">select</span>(iris, Petal.Length<span class="op">:</span>Species)
<span class="kw">select</span>(iris, <span class="op">-</span>(Petal.Length<span class="op">:</span>Species)) <span class="co">#selects everything, except those cols</span></code></pre></div>
<p>To select 3 columns and rename <em>subject</em> to <em>SUBJ</em> and put liik as the 1st col:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(iris, <span class="dt">liik =</span> Species, Sepal.Length, Sepal.Width )</code></pre></div>
<pre><code>##           liik Sepal.Length Sepal.Width
## 1       setosa          5.1         3.5
## 2       setosa          4.9         3.0
## 3       setosa          4.7         3.2
## 4       setosa          4.6         3.1
## 5       setosa          5.0         3.6
## 6       setosa          5.4         3.9
## 7       setosa          4.6         3.4
## 8       setosa          5.0         3.4
## 9       setosa          4.4         2.9
## 10      setosa          4.9         3.1
## 11      setosa          5.4         3.7
## 12      setosa          4.8         3.4
## 13      setosa          4.8         3.0
## 14      setosa          4.3         3.0
## 15      setosa          5.8         4.0
## 16      setosa          5.7         4.4
## 17      setosa          5.4         3.9
## 18      setosa          5.1         3.5
## 19      setosa          5.7         3.8
## 20      setosa          5.1         3.8
## 21      setosa          5.4         3.4
## 22      setosa          5.1         3.7
## 23      setosa          4.6         3.6
## 24      setosa          5.1         3.3
## 25      setosa          4.8         3.4
## 26      setosa          5.0         3.0
## 27      setosa          5.0         3.4
## 28      setosa          5.2         3.5
## 29      setosa          5.2         3.4
## 30      setosa          4.7         3.2
## 31      setosa          4.8         3.1
## 32      setosa          5.4         3.4
## 33      setosa          5.2         4.1
## 34      setosa          5.5         4.2
## 35      setosa          4.9         3.1
## 36      setosa          5.0         3.2
## 37      setosa          5.5         3.5
## 38      setosa          4.9         3.6
## 39      setosa          4.4         3.0
## 40      setosa          5.1         3.4
## 41      setosa          5.0         3.5
## 42      setosa          4.5         2.3
## 43      setosa          4.4         3.2
## 44      setosa          5.0         3.5
## 45      setosa          5.1         3.8
## 46      setosa          4.8         3.0
## 47      setosa          5.1         3.8
## 48      setosa          4.6         3.2
## 49      setosa          5.3         3.7
## 50      setosa          5.0         3.3
## 51  versicolor          7.0         3.2
## 52  versicolor          6.4         3.2
## 53  versicolor          6.9         3.1
## 54  versicolor          5.5         2.3
## 55  versicolor          6.5         2.8
## 56  versicolor          5.7         2.8
## 57  versicolor          6.3         3.3
## 58  versicolor          4.9         2.4
## 59  versicolor          6.6         2.9
## 60  versicolor          5.2         2.7
## 61  versicolor          5.0         2.0
## 62  versicolor          5.9         3.0
## 63  versicolor          6.0         2.2
## 64  versicolor          6.1         2.9
## 65  versicolor          5.6         2.9
## 66  versicolor          6.7         3.1
## 67  versicolor          5.6         3.0
## 68  versicolor          5.8         2.7
## 69  versicolor          6.2         2.2
## 70  versicolor          5.6         2.5
## 71  versicolor          5.9         3.2
## 72  versicolor          6.1         2.8
## 73  versicolor          6.3         2.5
## 74  versicolor          6.1         2.8
## 75  versicolor          6.4         2.9
## 76  versicolor          6.6         3.0
## 77  versicolor          6.8         2.8
## 78  versicolor          6.7         3.0
## 79  versicolor          6.0         2.9
## 80  versicolor          5.7         2.6
## 81  versicolor          5.5         2.4
## 82  versicolor          5.5         2.4
## 83  versicolor          5.8         2.7
## 84  versicolor          6.0         2.7
## 85  versicolor          5.4         3.0
## 86  versicolor          6.0         3.4
## 87  versicolor          6.7         3.1
## 88  versicolor          6.3         2.3
## 89  versicolor          5.6         3.0
## 90  versicolor          5.5         2.5
## 91  versicolor          5.5         2.6
## 92  versicolor          6.1         3.0
## 93  versicolor          5.8         2.6
## 94  versicolor          5.0         2.3
## 95  versicolor          5.6         2.7
## 96  versicolor          5.7         3.0
## 97  versicolor          5.7         2.9
## 98  versicolor          6.2         2.9
## 99  versicolor          5.1         2.5
## 100 versicolor          5.7         2.8
## 101  virginica          6.3         3.3
## 102  virginica          5.8         2.7
## 103  virginica          7.1         3.0
## 104  virginica          6.3         2.9
## 105  virginica          6.5         3.0
## 106  virginica          7.6         3.0
## 107  virginica          4.9         2.5
## 108  virginica          7.3         2.9
## 109  virginica          6.7         2.5
## 110  virginica          7.2         3.6
## 111  virginica          6.5         3.2
## 112  virginica          6.4         2.7
## 113  virginica          6.8         3.0
## 114  virginica          5.7         2.5
## 115  virginica          5.8         2.8
## 116  virginica          6.4         3.2
## 117  virginica          6.5         3.0
## 118  virginica          7.7         3.8
## 119  virginica          7.7         2.6
## 120  virginica          6.0         2.2
## 121  virginica          6.9         3.2
## 122  virginica          5.6         2.8
## 123  virginica          7.7         2.8
## 124  virginica          6.3         2.7
## 125  virginica          6.7         3.3
## 126  virginica          7.2         3.2
## 127  virginica          6.2         2.8
## 128  virginica          6.1         3.0
## 129  virginica          6.4         2.8
## 130  virginica          7.2         3.0
## 131  virginica          7.4         2.8
## 132  virginica          7.9         3.8
## 133  virginica          6.4         2.8
## 134  virginica          6.3         2.8
## 135  virginica          6.1         2.6
## 136  virginica          7.7         3.0
## 137  virginica          6.3         3.4
## 138  virginica          6.4         3.1
## 139  virginica          6.0         3.0
## 140  virginica          6.9         3.1
## 141  virginica          6.7         3.1
## 142  virginica          6.9         3.1
## 143  virginica          5.8         2.7
## 144  virginica          6.8         3.2
## 145  virginica          6.7         3.3
## 146  virginica          6.7         3.0
## 147  virginica          6.3         2.5
## 148  virginica          6.5         3.0
## 149  virginica          6.2         3.4
## 150  virginica          5.9         3.0</code></pre>
<p>To select all cols, except sex and value, and rename the <em>subject</em> col:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(iris, <span class="op">-</span>Sepal.Length, <span class="op">-</span>Sepal.Width, <span class="dt">liik =</span> Species)</code></pre></div>
<p><strong>helper functions you can use within select():</strong></p>
<p>starts_with(“abc”): matches names that begin with “abc.”</p>
<p>ends_with(“xyz”): matches names that end with “xyz.”</p>
<p>contains(“ijk”): matches names that contain “ijk.”</p>
<p>matches(“(.)\1”): selects variables that match a regular expression. This one matches any variables that contain repeated characters.</p>
<p>num_range(“x”, 1:3) matches x1, x2 and x3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(iris)
<span class="kw">select</span>(iris, <span class="kw">starts_with</span>(<span class="st">&quot;Petal&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 150 x 2
##    Petal.Length Petal.Width
##           &lt;dbl&gt;       &lt;dbl&gt;
##  1          1.4         0.2
##  2          1.4         0.2
##  3          1.3         0.2
##  4          1.5         0.2
##  5          1.4         0.2
##  6          1.7         0.4
##  7          1.4         0.3
##  8          1.5         0.2
##  9          1.4         0.2
## 10          1.5         0.1
## # ... with 140 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(iris, <span class="kw">ends_with</span>(<span class="st">&quot;Width&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 150 x 2
##    Sepal.Width Petal.Width
##          &lt;dbl&gt;       &lt;dbl&gt;
##  1         3.5         0.2
##  2         3.0         0.2
##  3         3.2         0.2
##  4         3.1         0.2
##  5         3.6         0.2
##  6         3.9         0.4
##  7         3.4         0.3
##  8         3.4         0.2
##  9         2.9         0.2
## 10         3.1         0.1
## # ... with 140 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Move Species variable to the front</span>
<span class="kw">select</span>(iris, Species, <span class="kw">everything</span>())</code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Species Sepal.Length Sepal.Width Petal.Length Petal.Width
##     &lt;fctr&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1  setosa          5.1         3.5          1.4         0.2
##  2  setosa          4.9         3.0          1.4         0.2
##  3  setosa          4.7         3.2          1.3         0.2
##  4  setosa          4.6         3.1          1.5         0.2
##  5  setosa          5.0         3.6          1.4         0.2
##  6  setosa          5.4         3.9          1.7         0.4
##  7  setosa          4.6         3.4          1.4         0.3
##  8  setosa          5.0         3.4          1.5         0.2
##  9  setosa          4.4         2.9          1.4         0.2
## 10  setosa          4.9         3.1          1.5         0.1
## # ... with 140 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">100</span>), <span class="dt">nrow =</span> <span class="dv">10</span>))
dat &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(dat[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">10</span>)])
<span class="kw">select</span>(dat, V9<span class="op">:</span>V6)</code></pre></div>
<pre><code>## # A tibble: 10 x 5
##            V9        V8         V5        V2        V6
##         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 0.82029598 0.4073683 0.79174713 0.5282797 0.8969044
##  2 0.01551464 0.8008126 0.22062719 0.2704167 0.9719448
##  3 0.96506768 0.2785442 0.07088738 0.3301603 0.6816152
##  4 0.63693286 0.1462736 0.12509697 0.4111910 0.9454725
##  5 0.21742551 0.7103206 0.24014552 0.7789167 0.6377199
##  6 0.69191906 0.4345942 0.26786689 0.3362991 0.9437041
##  7 0.57040223 0.2642452 0.76811641 0.1502595 0.5901690
##  8 0.31175680 0.3107721 0.42316993 0.1721390 0.3617029
##  9 0.98166527 0.9089279 0.94203031 0.4586941 0.9848984
## 10 0.22225932 0.7602869 0.38566444 0.3487143 0.6336417</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(dat, <span class="kw">num_range</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>))</code></pre></div>
<pre><code>## # A tibble: 10 x 4
##            V9        V8         V7        V6
##         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1 0.82029598 0.4073683 0.99021987 0.8969044
##  2 0.01551464 0.8008126 0.08988879 0.9719448
##  3 0.96506768 0.2785442 0.43138183 0.6816152
##  4 0.63693286 0.1462736 0.31742185 0.9454725
##  5 0.21742551 0.7103206 0.38326627 0.6377199
##  6 0.69191906 0.4345942 0.93879975 0.9437041
##  7 0.57040223 0.2642452 0.71874306 0.5901690
##  8 0.31175680 0.3107721 0.95085561 0.3617029
##  9 0.98166527 0.9089279 0.25383552 0.9848984
## 10 0.22225932 0.7602869 0.02996284 0.6336417</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Drop variables with -</span>
<span class="kw">select</span>(iris, <span class="op">-</span><span class="kw">starts_with</span>(<span class="st">&quot;Petal&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 150 x 3
##    Sepal.Length Sepal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;  &lt;fctr&gt;
##  1          5.1         3.5  setosa
##  2          4.9         3.0  setosa
##  3          4.7         3.2  setosa
##  4          4.6         3.1  setosa
##  5          5.0         3.6  setosa
##  6          5.4         3.9  setosa
##  7          4.6         3.4  setosa
##  8          5.0         3.4  setosa
##  9          4.4         2.9  setosa
## 10          4.9         3.1  setosa
## # ... with 140 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Renaming -----------------------------------------</span>
<span class="co"># select() keeps only the variables you specify</span>
<span class="co"># rename() keeps all variables</span>
<span class="kw">rename</span>(iris, <span class="dt">petal_length =</span> Petal.Length)</code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width petal_length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;  &lt;fctr&gt;
##  1          5.1         3.5          1.4         0.2  setosa
##  2          4.9         3.0          1.4         0.2  setosa
##  3          4.7         3.2          1.3         0.2  setosa
##  4          4.6         3.1          1.5         0.2  setosa
##  5          5.0         3.6          1.4         0.2  setosa
##  6          5.4         3.9          1.7         0.4  setosa
##  7          4.6         3.4          1.4         0.3  setosa
##  8          5.0         3.4          1.5         0.2  setosa
##  9          4.4         2.9          1.4         0.2  setosa
## 10          4.9         3.1          1.5         0.1  setosa
## # ... with 140 more rows</code></pre>
<p>See ?select for more details.</p>
</div>
<div id="filter-rows" class="section level3">
<h3><span class="header-section-number">5.9.2</span> <code>filter()</code> rows</h3>
<p>Keep rows in Iris that have Species level “setosa” <strong>and</strong> Sepal.Length value &lt;4.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Sepal.Length <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.5</span>)</code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;  &lt;fctr&gt;
## 1          4.4         2.9          1.4         0.2  setosa
## 2          4.3         3.0          1.1         0.1  setosa
## 3          4.4         3.0          1.3         0.2  setosa
## 4          4.4         3.2          1.3         0.2  setosa</code></pre>
<p>Keep rows in Iris that have Species level “setosa” <strong>or</strong> Sepal.Length value &lt;4.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">|</span><span class="st"> </span>Sepal.Length <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.5</span>)</code></pre></div>
<pre><code>## # A tibble: 50 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;  &lt;fctr&gt;
##  1          5.1         3.5          1.4         0.2  setosa
##  2          4.9         3.0          1.4         0.2  setosa
##  3          4.7         3.2          1.3         0.2  setosa
##  4          4.6         3.1          1.5         0.2  setosa
##  5          5.0         3.6          1.4         0.2  setosa
##  6          5.4         3.9          1.7         0.4  setosa
##  7          4.6         3.4          1.4         0.3  setosa
##  8          5.0         3.4          1.5         0.2  setosa
##  9          4.4         2.9          1.4         0.2  setosa
## 10          4.9         3.1          1.5         0.1  setosa
## # ... with 40 more rows</code></pre>
<p>Keep rows in Iris that have Species level “not setosa” <strong>or</strong> Sepal.Length value &lt;4.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species <span class="op">!=</span><span class="st">&quot;setosa&quot;</span> <span class="op">|</span><span class="st"> </span>Sepal.Length <span class="op">&lt;</span><span class="st"> </span><span class="fl">4.5</span>)</code></pre></div>
<pre><code>## # A tibble: 104 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;     &lt;fctr&gt;
##  1          4.4         2.9          1.4         0.2     setosa
##  2          4.3         3.0          1.1         0.1     setosa
##  3          4.4         3.0          1.3         0.2     setosa
##  4          4.4         3.2          1.3         0.2     setosa
##  5          7.0         3.2          4.7         1.4 versicolor
##  6          6.4         3.2          4.5         1.5 versicolor
##  7          6.9         3.1          4.9         1.5 versicolor
##  8          5.5         2.3          4.0         1.3 versicolor
##  9          6.5         2.8          4.6         1.5 versicolor
## 10          5.7         2.8          4.5         1.3 versicolor
## # ... with 94 more rows</code></pre>
<p>Kui tahame samast veerust filtreerida “või” ehk “|” abil mitu väärtust, on meil valida kahe samaväärse variandi vahel (tegelikult töötab 2. variant ka ühe väärtuse korral)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(iris, Species <span class="op">==</span><span class="st">&quot;setosa&quot;</span> <span class="op">|</span><span class="st"> </span>Species <span class="op">==</span><span class="st">&quot;versicolor&quot;</span>)
<span class="kw">filter</span>(iris, Species <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;setosa&quot;</span>, <span class="st">&quot;versicolor&quot;</span>) )</code></pre></div>
<p>Nagu näha, 2. variant on oluliselt lühem.</p>
<p>Filtering with regular expression: we keep the rows where <em>subject</em> starts with the letter “T”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="kw">filter</span>(iris, <span class="kw">str_detect</span>(Species, <span class="st">&quot;^v&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 100 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;     &lt;fctr&gt;
##  1          7.0         3.2          4.7         1.4 versicolor
##  2          6.4         3.2          4.5         1.5 versicolor
##  3          6.9         3.1          4.9         1.5 versicolor
##  4          5.5         2.3          4.0         1.3 versicolor
##  5          6.5         2.8          4.6         1.5 versicolor
##  6          5.7         2.8          4.5         1.3 versicolor
##  7          6.3         3.3          4.7         1.6 versicolor
##  8          4.9         2.4          3.3         1.0 versicolor
##  9          6.6         2.9          4.6         1.3 versicolor
## 10          5.2         2.7          3.9         1.4 versicolor
## # ... with 90 more rows</code></pre>
<p>As you can see there are endless vistas here, open for a regular expression fanatic. I wish I was one!</p>
<p>remove NAs with <code>filter()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))</code></pre></div>
</div>
<div id="summarise" class="section level3">
<h3><span class="header-section-number">5.9.3</span> <code>summarise()</code></h3>
<p>Many rows summarised to a single value</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarise</span>(iris, 
          <span class="dt">MEAN =</span> <span class="kw">mean</span>(Sepal.Length), 
          <span class="dt">SD =</span> <span class="kw">sd</span>(Sepal.Length), 
          <span class="dt">N =</span> <span class="kw">n</span>(), 
          <span class="dt">n_species =</span> <span class="kw">n_distinct</span>(Species))</code></pre></div>
<pre><code>## # A tibble: 1 x 4
##       MEAN        SD     N n_species
##      &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;     &lt;int&gt;
## 1 5.843333 0.8280661   150         3</code></pre>
<p><code>n()</code> loeb üles, mitu väärtust läks selle summary statistic-u arvutusse,</p>
<p><code>n_distinct()</code> loeb üles, mitu unikaalset väärtust läks samasse arvutusse.</p>
<p>summarise on kasulikum, kui teda kasutada koos järgmise verbi, group_by-ga.</p>
</div>
<div id="group_by" class="section level3">
<h3><span class="header-section-number">5.9.4</span> <code>group_by()</code></h3>
<p><code>group_by()</code> groups values for summarising or mutating-</p>
<p>When we summarise by <em>sex</em> we will get two values for each summary statistic: for males and females. Aint that sexy?!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris_grouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(iris, Species) 
<span class="kw">summarise</span>(iris_grouped, 
          <span class="dt">MEAN =</span> <span class="kw">mean</span>(Sepal.Length), 
          <span class="dt">SD =</span> <span class="kw">sd</span>(Sepal.Length), 
          <span class="dt">N =</span> <span class="kw">n</span>(), 
          <span class="dt">n_species =</span> <span class="kw">n_distinct</span>(Species))</code></pre></div>
<pre><code>## # A tibble: 3 x 5
##      Species  MEAN        SD     N n_species
##       &lt;fctr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;     &lt;int&gt;
## 1     setosa 5.006 0.3524897    50         1
## 2 versicolor 5.936 0.5161711    50         1
## 3  virginica 6.588 0.6358796    50         1</code></pre>
<p><code>summarise()</code> argumendid on indentsed eelmise näitega aga tulemus ei ole. Siin me rakendame summarise verbi mitte kogu tabelile, vaid 3-le virtuaalsele tabelile, mis on saadud algsest tabelist.</p>
<p><code>group_by()</code>-le saab anda järjest mitu grupeerivat muutujat. Siis ta grupeerib kõigepealt neist esimese järgi, seejärel lõõb saadud grupid omakorda lahku teise argumendi järgi ja nii edasi kuni teie poolt antud argumendid otsa saavad.</p>
<p>Now we group previously generated dat_lng data frame first by <em>sex</em> and then inside each group again by <em>experiment</em>. This is getting complicated …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_lng</code></pre></div>
<pre><code>## # A tibble: 9 x 4
##   subject   sex   experiment value
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;
## 1     Tim     M      control    23
## 2     Ann     F      control    31
## 3    Jill     F      control    30
## 4     Tim     M experiment_1    34
## 5     Ann     F experiment_1    38
## 6    Jill     F experiment_1    36
## 7     Tim     M experiment_2    40
## 8     Ann     F experiment_2    42
## 9    Jill     F experiment_2    44</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(dat_lng, sex, experiment) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">MEAN =</span> <span class="kw">mean</span>(value), 
            <span class="dt">SD =</span> <span class="kw">sd</span>(value),
            <span class="dt">N =</span> <span class="kw">n</span>(), 
            <span class="dt">n_sex =</span> <span class="kw">n_distinct</span>(sex))</code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   sex [?]
##     sex   experiment  MEAN        SD     N n_sex
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1     F      control  30.5 0.7071068     2     1
## 2     F experiment_1  37.0 1.4142136     2     1
## 3     F experiment_2  43.0 1.4142136     2     1
## 4     M      control  23.0        NA     1     1
## 5     M experiment_1  34.0        NA     1     1
## 6     M experiment_2  40.0        NA     1     1</code></pre>
<p>Now we group first by sex and then by variable. Spot the difference!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(dat_lng, experiment, sex) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">MEAN =</span> <span class="kw">mean</span>(value), 
            <span class="dt">SD =</span> <span class="kw">sd</span>(value),
            <span class="dt">N =</span> <span class="kw">n</span>(), 
            <span class="dt">n_sex =</span> <span class="kw">n_distinct</span>(sex))</code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   experiment [?]
##     experiment   sex  MEAN        SD     N n_sex
##          &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
## 1      control     F  30.5 0.7071068     2     1
## 2      control     M  23.0        NA     1     1
## 3 experiment_1     F  37.0 1.4142136     2     1
## 4 experiment_1     M  34.0        NA     1     1
## 5 experiment_2     F  43.0 1.4142136     2     1
## 6 experiment_2     M  40.0        NA     1     1</code></pre>
<p><em>pro tip</em> if you want to summarise and then display the summary values as new column(s), which are added to the original non-shrunk df, use <code>mutate()</code> instead of <code>summarise()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(iris_grouped,
       <span class="dt">MEAN =</span> <span class="kw">mean</span>(Sepal.Length), 
       <span class="dt">SD =</span> <span class="kw">sd</span>(Sepal.Length))</code></pre></div>
<pre><code>## # A tibble: 150 x 7
## # Groups:   Species [3]
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species  MEAN
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;  &lt;fctr&gt; &lt;dbl&gt;
##  1          5.1         3.5          1.4         0.2  setosa 5.006
##  2          4.9         3.0          1.4         0.2  setosa 5.006
##  3          4.7         3.2          1.3         0.2  setosa 5.006
##  4          4.6         3.1          1.5         0.2  setosa 5.006
##  5          5.0         3.6          1.4         0.2  setosa 5.006
##  6          5.4         3.9          1.7         0.4  setosa 5.006
##  7          4.6         3.4          1.4         0.3  setosa 5.006
##  8          5.0         3.4          1.5         0.2  setosa 5.006
##  9          4.4         2.9          1.4         0.2  setosa 5.006
## 10          4.9         3.1          1.5         0.1  setosa 5.006
## # ... with 140 more rows, and 1 more variables: SD &lt;dbl&gt;</code></pre>
<p>Anna igast grupist 3 kõrgeimat väärtust ja 2 madalaimat väärtust. Samad numbrid erinevates ridades antakse kõik - selle pärast on meil tabelis rohkem ridu.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">top_n</span>(iris_grouped, <span class="dv">3</span>, Sepal.Length)
<span class="kw">top_n</span>(iris_grouped, <span class="op">-</span><span class="dv">2</span>, Sepal.Length)</code></pre></div>
</div>
<div id="mutate" class="section level3">
<h3><span class="header-section-number">5.9.5</span> 5. mutate</h3>
<p>Mutate põhikasutus on siiski uute veergude tekitamine, mis võtavad endale inputi rea kaupa. Seega tabeli ridade arv ei muutu.</p>
<p>if in your tibble called ‘df’ you have a column called ‘value’, you can create a new log2 transformed value value column called log_value by <code>df %&gt;% mutate(log_value = log2(value))</code>. Or you can create a new column where a constant is substracted from the value column: <code>df %&gt;% mutate(centered_value = value - mean(value) )</code>. Here the mean value is substracted from each individual value.</p>
<p><strong>Mutate adds new columns (and <code>transmute()</code> creates new columns while losing the previous columns)</strong></p>
<p>Here we firstly create a new column, which contains log-transformed values from the <em>value</em> column, and name it <em>log_value</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(dat_lng, <span class="dt">log_value =</span> <span class="kw">log</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   subject   sex   experiment value log_value
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1     Tim     M      control    23  3.135494
## 2     Ann     F      control    31  3.433987
## 3    Jill     F      control    30  3.401197
## 4     Tim     M experiment_1    34  3.526361
## 5     Ann     F experiment_1    38  3.637586
## 6    Jill     F experiment_1    36  3.583519
## 7     Tim     M experiment_2    40  3.688879
## 8     Ann     F experiment_2    42  3.737670
## 9    Jill     F experiment_2    44  3.784190</code></pre>
<p>The same with transmute: note the dropping of some of the original cols, keeping the original <em>subject</em> col and renaming the <em>sex</em> col.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(dat_lng, subject, <span class="dt">gender =</span> sex, <span class="dt">log_value =</span> <span class="kw">log</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   subject gender log_value
##     &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;
## 1     Tim      M  3.135494
## 2     Ann      F  3.433987
## 3    Jill      F  3.401197
## 4     Tim      M  3.526361
## 5     Ann      F  3.637586
## 6    Jill      F  3.583519
## 7     Tim      M  3.688879
## 8     Ann      F  3.737670
## 9    Jill      F  3.784190</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, 
                      year<span class="op">:</span>day, 
                      <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), 
                      distance, 
                      air_time) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gain =</span> arr_delay <span class="op">-</span><span class="st"> </span>dep_delay,
    <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,
    <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours)</code></pre></div>
<p><em><code>mutate_all()</code>, <code>mutate_if()</code> and <code>mutate_at()</code> and the three variants of <code>transmute()</code> (<code>transmute_all()</code>, <code>transmute_if()</code>, <code>transmute_at()</code>) make it easy to apply a transformation to a selection of variables. See help.</em></p>
<p>Here we first group and then mutate. Note that now, instead of a single constant, we divide by as many different constant as there are discrete factor levels in the sex variable (two, in our case):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">group_by</span>(dat_lng, sex) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">norm_value =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(value), 
         <span class="dt">n2_val =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 6
## # Groups:   sex [2]
##   subject   sex   experiment value norm_value   n2_val
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
## 1     Tim     M      control    23  0.7113402 2.667694
## 2     Ann     F      control    31  0.8416290 5.465862
## 3    Jill     F      control    30  0.8144796 5.289544
## 4     Tim     M experiment_1    34  1.0515464 3.943548
## 5     Ann     F experiment_1    38  1.0316742 6.700089
## 6    Jill     F experiment_1    36  0.9773756 6.347453
## 7     Tim     M experiment_2    40  1.2371134 4.639468
## 8     Ann     F experiment_2    42  1.1402715 7.405361
## 9    Jill     F experiment_2    44  1.1945701 7.757998</code></pre>
<p>Compare with a “straight” mutate to see the difference in values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(dat_lng, 
       <span class="dt">norm_value =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(value), 
       <span class="dt">n2_val =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(value))</code></pre></div>
<pre><code>## # A tibble: 9 x 6
##   subject   sex   experiment value norm_value   n2_val
##     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
## 1     Tim     M      control    23  0.6509434 3.477273
## 2     Ann     F      control    31  0.8773585 4.686759
## 3    Jill     F      control    30  0.8490566 4.535574
## 4     Tim     M experiment_1    34  0.9622642 5.140317
## 5     Ann     F experiment_1    38  1.0754717 5.745060
## 6    Jill     F experiment_1    36  1.0188679 5.442688
## 7     Tim     M experiment_2    40  1.1320755 6.047432
## 8     Ann     F experiment_2    42  1.1886792 6.349803
## 9    Jill     F experiment_2    44  1.2452830 6.652175</code></pre>
</div>
<div id="grouped-filters" class="section level3">
<h3><span class="header-section-number">5.9.6</span> Grouped filters</h3>
<p>Keep all groups bigger than a threshold:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">popular_dests &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">365</span>)</code></pre></div>
<p>If you need to remove grouping, and return to operations on ungrouped data, use <code>ungroup()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ungroup</span>(dat) </code></pre></div>
<p><code>str_replace_all()</code> helps to deal with unruly labelling inside columns containing strings</p>
<p>The idea is to find a pattern in a collection of strings and replace it with something else. String == character vector.</p>
<p>To find and replace we use <code>str_replace_all()</code>, whose base R analogue is <code>gsub()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
(bad.df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">time =</span> <span class="kw">c</span>(<span class="st">&quot;t0&quot;</span>, <span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t12&quot;</span>), <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">9</span>)))</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;chr&gt; &lt;dbl&gt;
## 1    t0     2
## 2    t1     4
## 3   t12     9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">get_numeric &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) <span class="kw">as.numeric</span>(<span class="kw">str_replace_all</span>(x, ...))
(bad.df &lt;-<span class="st"> </span><span class="kw">mutate_at</span>(bad.df, <span class="st">&quot;time&quot;</span>, get_numeric, <span class="dt">pattern =</span> <span class="st">&quot;t&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     0     2
## 2     1     4
## 3    12     9</code></pre>
<p>now we have a numeric time column, which can be used in plotting.</p>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
(bad.df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">time =</span> <span class="kw">c</span>(<span class="st">&quot;t0&quot;</span>, <span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t12&quot;</span>), <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">9</span>)))</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;chr&gt; &lt;dbl&gt;
## 1    t0     2
## 2    t1     4
## 3   t12     9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate_at</span>(bad.df, <span class="st">&quot;time&quot;</span>, parse_number)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##    time value
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     0     2
## 2     1     4
## 3    12     9</code></pre>
<p>Here we did the same thing more elegantly by directly parsing numbers from a character string.</p>
</div>
<div id="separate-one-column-into-several" class="section level3">
<h3><span class="header-section-number">5.9.7</span> <code>separate()</code> one column into several</h3>
<p>Siin on veel üks verb, mida aeg-ajalt kõigil vaja läheb. <code>separate()</code> võtab ühe veeru sisu (mis peab olema character string) ning jagab selle laiali mitme uue veeru vahel. Kui teda kasutada vormis <code>separate(df, old_Column, into=c(&quot;new_col1&quot;, &quot;new_col2&quot;, &quot;ja_nii_edasi&quot;))</code> siis püüab programm ise ära arvata, kustkohalt veeru sisu hakkida (tühikud, komad, semikoolonid, koolonid jne). Aga te võite eksplitsiitselt ette anda separaatori sep = “”. sep = 2 tähendab “peale 2. tähemärki”. sep = -6 tähendab “enne tagantpoolt 6. tähemärki”</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">country =</span> <span class="kw">c</span>(<span class="st">&quot;Albania&quot;</span>), <span class="dt">disease.cases =</span> <span class="kw">c</span>(<span class="st">&quot;80/1000&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   country disease.cases
##     &lt;chr&gt;         &lt;chr&gt;
## 1 Albania       80/1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80     1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80     1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="dt">sep =</span> <span class="dv">2</span>))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80    /1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(df.sep &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disease.cases, <span class="dt">into=</span><span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;thousand&quot;</span>), <span class="dt">sep =</span> <span class="op">-</span><span class="dv">6</span>))</code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   country cases thousand
## *   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;
## 1 Albania    80    /1000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), 
               <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Procaryota; Bacteria; Alpha-Proteobacteria; Escharichia&quot;</span>, <span class="st">&quot;Eukaryota; Chordata&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   index                                                   taxon
##   &lt;dbl&gt;                                                   &lt;chr&gt;
## 1     1 Procaryota; Bacteria; Alpha-Proteobacteria; Escharichia
## 2     2                                     Eukaryota; Chordata</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&#39;; &#39;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index       riik      hmk                klass    perekond
## * &lt;dbl&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;       &lt;chr&gt;
## 1     1 Procaryota Bacteria Alpha-Proteobacteria Escharichia
## 2     2  Eukaryota Chordata                 &lt;NA&gt;        &lt;NA&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># some special cases:</span>
(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), 
               <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Prokaryota || Bacteria || Alpha-Proteobacteria || Escharichia&quot;</span>, <span class="st">&quot;Eukaryota || Chordata&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   index                                                         taxon
##   &lt;dbl&gt;                                                         &lt;chr&gt;
## 1     1 Prokaryota || Bacteria || Alpha-Proteobacteria || Escharichia
## 2     2                                         Eukaryota || Chordata</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&quot;riik&quot;</span>, <span class="st">&quot;hmk&quot;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">|</span><span class="ch">\\</span><span class="st">|&quot;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index        riik        hmk                  klass     perekond
## * &lt;dbl&gt;       &lt;chr&gt;      &lt;chr&gt;                  &lt;chr&gt;        &lt;chr&gt;
## 1     1 Prokaryota   Bacteria   Alpha-Proteobacteria   Escharichia
## 2     2  Eukaryota    Chordata                   &lt;NA&gt;         &lt;NA&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), 
              <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Prokaryota.Bacteria.Alpha-Proteobacteria.Escharichia&quot;</span>, <span class="st">&quot;Eukaryota.Chordata&quot;</span>))
(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&#39;[.]&#39;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)) </code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index       riik      hmk                klass    perekond
## * &lt;dbl&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;       &lt;chr&gt;
## 1     1 Prokaryota Bacteria Alpha-Proteobacteria Escharichia
## 2     2  Eukaryota Chordata                 &lt;NA&gt;        &lt;NA&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(dat &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">index =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), 
               <span class="dt">taxon =</span> <span class="kw">c</span>(<span class="st">&quot;Prokaryota.Bacteria,Alpha-Proteobacteria.Escharichia&quot;</span>, <span class="st">&quot;Eukaryota.Chordata&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   index                                                taxon
##   &lt;dbl&gt;                                                &lt;chr&gt;
## 1     1 Prokaryota.Bacteria,Alpha-Proteobacteria.Escharichia
## 2     2                                   Eukaryota.Chordata</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(d1 &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(taxon, <span class="kw">c</span>(<span class="st">&#39;riik&#39;</span>, <span class="st">&#39;hmk&#39;</span>, <span class="st">&quot;klass&quot;</span>, <span class="st">&quot;perekond&quot;</span>), <span class="dt">sep =</span> <span class="st">&#39;[,</span><span class="ch">\\</span><span class="st">.]&#39;</span>, <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   index       riik      hmk                klass    perekond
## * &lt;dbl&gt;      &lt;chr&gt;    &lt;chr&gt;                &lt;chr&gt;       &lt;chr&gt;
## 1     1 Prokaryota Bacteria Alpha-Proteobacteria Escharichia
## 2     2  Eukaryota Chordata                 &lt;NA&gt;        &lt;NA&gt;</code></pre>
<p>The companion FUN to separate is <code>unite()</code> - see help.</p>
</div>
</div>
<div id="faktorid" class="section level2">
<h2><span class="header-section-number">5.10</span> Faktorid</h2>
<p>Faktor on andmetüüp, mis oli ajalooliselt tähtsam kui ta praegu on. Sageli saame oma asja ära ajada character vectori andmetüübiga ja ei vaja faktorit. Aga siiski läheb faktoreid aeg-ajalt kõigil vaja.</p>
<blockquote>
<p>Faktorite abil töötame kategooriliste muutujatega, millel on fikseeritud hulk võimalikke väärtusi, mida me kõiki teame.</p>
</blockquote>
<p>Faktori väärtusi kutsutakse “tasemeteks” (levels). Näiteks: muutuja sex on 2 tasemega faktor (M, F)</p>
<p><strong>NB! Faktoriks muutes saame character vectori liikmete järjekorra muuta mitte-tähestikuliseks</strong></p>
<p>Me kasutame faktoritega töötamisel forcats paketti. Kõigepealt loome character vectori x1 nelja kuu nime ingliskeelse lühendiga.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(forcats)
x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dec&quot;</span>, <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Mar&quot;</span>)</code></pre></div>
<p>Nüüd kujutlege, et vektor x1 sisaldab 10 000 elementi. Seda vektorit on raske sorteerida, ja trükivead on ka raskesti leitavad. Mõlema probleemi vastu aitab, kui me konverteerime x1-e faktoriks. Selleks, et luua uus faktor, peaks kõigepealt üles lugema selle faktori kõik võimalikud tasemed:</p>
<p>Nüüd loome uue faktori ehk muudame x1 character vektori y1 factor vektoriks. Erinevalt x1-st seostub iga y1 väärtusega faktori tase. Kui algses vektoris on mõni element, millele ei vasta näiteks trükivea tõttu ühtegi faktori taset, siis see element muudetakse NA-ks. Proovige see ise järele, viies trükivea sisse x1-e.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y1 &lt;-<span class="st"> </span><span class="kw">factor</span>(x1, <span class="dt">levels =</span> month.abb)
y1</code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
<p><strong>Kui sa faktorile tasemeid ette ei anna, siis need tekivad andmetest automaatselt ja tähestikulises järjekorras.</strong></p>
<p>Kui sa tahad, et faktori tasemed oleks samas järjekorras kui selle taseme esmakordne ilmumine teie andmetes siis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">f2 &lt;-<span class="st"> </span>x1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_inorder</span>()
f2</code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## Levels: Dec Apr Jan Mar</code></pre>
<p><code>levels()</code> annab faktori tasemed ja nende järjekorra</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(f2)</code></pre></div>
<pre><code>## [1] &quot;Dec&quot; &quot;Apr&quot; &quot;Jan&quot; &quot;Mar&quot;</code></pre>
<p>Kui faktorid on tibbles oma veeruna, siis saab nende tasemed <code>count()</code> kasutades</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="co">#tibble, mille veerg &quot;race&quot; on faktor.</span></code></pre></div>
<pre><code>## # A tibble: 21,483 x 9
##     year       marital   age   race        rincome            partyid
##    &lt;int&gt;        &lt;fctr&gt; &lt;int&gt; &lt;fctr&gt;         &lt;fctr&gt;             &lt;fctr&gt;
##  1  2000 Never married    26  White  $8000 to 9999       Ind,near rep
##  2  2000      Divorced    48  White  $8000 to 9999 Not str republican
##  3  2000       Widowed    67  White Not applicable        Independent
##  4  2000 Never married    39  White Not applicable       Ind,near rep
##  5  2000      Divorced    25  White Not applicable   Not str democrat
##  6  2000       Married    25  White $20000 - 24999    Strong democrat
##  7  2000 Never married    36  White $25000 or more Not str republican
##  8  2000      Divorced    44  White  $7000 to 7999       Ind,near dem
##  9  2000       Married    44  White $25000 or more   Not str democrat
## 10  2000       Married    47  White $25000 or more  Strong republican
## # ... with 21,473 more rows, and 3 more variables: relig &lt;fctr&gt;,
## #   denom &lt;fctr&gt;, tvhours &lt;int&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(race)</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     race     n
##   &lt;fctr&gt; &lt;int&gt;
## 1  Other  1959
## 2  Black  3129
## 3  White 16395</code></pre>
<p>Nii saame ka teada, mitu korda iga faktori tase selles tabelis esineb.</p>
<div id="fct_recode-rekodeerib-faktori-tasemed" class="section level3">
<h3><span class="header-section-number">5.10.1</span> <code>fct_recode()</code> rekodeerib faktori tasemed</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(partyid)</code></pre></div>
<pre><code>## # A tibble: 10 x 2
##               partyid     n
##                &lt;fctr&gt; &lt;int&gt;
##  1          No answer   154
##  2         Don&#39;t know     1
##  3        Other party   393
##  4  Strong republican  2314
##  5 Not str republican  3032
##  6       Ind,near rep  1791
##  7        Independent  4119
##  8       Ind,near dem  2499
##  9   Not str democrat  3690
## 10    Strong democrat  3490</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_recode</span>(partyid,
                              <span class="st">&quot;Republican, strong&quot;</span>    =<span class="st"> &quot;Strong republican&quot;</span>,
                              <span class="st">&quot;Republican, weak&quot;</span>      =<span class="st"> &quot;Not str republican&quot;</span>,
                              <span class="st">&quot;Independent, near rep&quot;</span> =<span class="st"> &quot;Ind,near rep&quot;</span>,
                              <span class="st">&quot;Independent, near dem&quot;</span> =<span class="st"> &quot;Ind,near dem&quot;</span>,
                              <span class="st">&quot;Democrat, weak&quot;</span>        =<span class="st"> &quot;Not str democrat&quot;</span>,
                              <span class="st">&quot;Democrat, strong&quot;</span>      =<span class="st"> &quot;Strong democrat&quot;</span>,
                              <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;No answer&quot;</span>,
                              <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;Don&#39;t know&quot;</span>,
                              <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;Other party&quot;</span>
  )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(partyid)</code></pre></div>
<pre><code>## # A tibble: 8 x 2
##                 partyid     n
##                  &lt;fctr&gt; &lt;int&gt;
## 1                 Other   548
## 2    Republican, strong  2314
## 3      Republican, weak  3032
## 4 Independent, near rep  1791
## 5           Independent  4119
## 6 Independent, near dem  2499
## 7        Democrat, weak  3690
## 8      Democrat, strong  3490</code></pre>
<p><code>fct_recode()</code> ei puuduta neid tasemeid, mida selle argumendis ei mainita. Lisaks saab mitu vana taset muuta üheks uueks tasemeks.</p>
</div>
<div id="fct_collapse-annab-argumenti-sisse-vanade-tasemete-vektori-et-teha-vahem-uusi-tasemeid." class="section level3">
<h3><span class="header-section-number">5.10.2</span> <code>fct_collapse()</code> annab argumenti sisse vanade tasemete vektori, et teha vähem uusi tasemeid.</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_collapse</span>(partyid,
                                <span class="dt">other =</span> <span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Other party&quot;</span>),
                                <span class="dt">rep =</span> <span class="kw">c</span>(<span class="st">&quot;Strong republican&quot;</span>, <span class="st">&quot;Not str republican&quot;</span>),
                                <span class="dt">ind =</span> <span class="kw">c</span>(<span class="st">&quot;Ind,near rep&quot;</span>, <span class="st">&quot;Independent&quot;</span>, <span class="st">&quot;Ind,near dem&quot;</span>),
                                <span class="dt">dem =</span> <span class="kw">c</span>(<span class="st">&quot;Not str democrat&quot;</span>, <span class="st">&quot;Strong democrat&quot;</span>)
  )) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(partyid)</code></pre></div>
</div>
<div id="fct_lump-loob-kokku-koik-vahem-arv-kordi-esinevad-tasemed." class="section level3">
<h3><span class="header-section-number">5.10.3</span> <code>fct_lump()</code> lööb kokku kõik vähem arv kordi esinevad tasemed.</h3>
<p>n parameeter ütleb, mitu algset taset tuleb alles jätta:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss_cat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">relig =</span> <span class="kw">fct_lump</span>(relig, <span class="dt">n =</span> <span class="dv">5</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(relig, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">print</span>()</code></pre></div>
<pre><code>## # A tibble: 6 x 2
##        relig     n
##       &lt;fctr&gt; &lt;int&gt;
## 1 Protestant 10846
## 2   Catholic  5124
## 3       None  3523
## 4      Other   913
## 5  Christian   689
## 6     Jewish   388</code></pre>
</div>
<div id="rekodeerime-pideva-muutuja-faktoriks" class="section level3">
<h3><span class="header-section-number">5.10.4</span> Rekodeerime pideva muutuja faktoriks</h3>
<p><code>cut()</code> jagab meie muutuja väärtused intervallidesse ja annab igale intervallile faktori taseme.</p>
<p><code>cut(x, breaks, labels = NULL, ordered_result = FALSE, ...)</code></p>
<p>breaks - either a numeric vector of two or more unique cut points or a single number &gt;1, giving the number of intervals into which x is to be cut. labels - labels for the levels of the resulting category. ordered_result - logical: should the result be an ordered factor?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
z1 &lt;-<span class="st"> </span><span class="kw">cut</span>(z, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">10</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>))
z1</code></pre></div>
<pre><code>##  [1] A A A B B B C C C C
## Levels: A B C</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Note that to include 1 in level “A” you need to start the first cut &lt;1, while at the right side 3 is included in the 1st cut (in factor level “A”)</span>
z2 &lt;-<span class="st"> </span><span class="kw">cut</span>(z, <span class="dt">breaks =</span> <span class="dv">3</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>))
z2</code></pre></div>
<pre><code>##  [1] A A A A B B B C C C
## Levels: A B C</code></pre>
<p><code>car::recode</code> aitab rekodeerida</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(car) <span class="co">#car:recode()</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">3</span>)
x</code></pre></div>
<pre><code>## [1] 1 2 3 1 2 3 1 2 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x, <span class="st">&quot;c(1,2)=&#39;A&#39;; else=&#39;B&#39;&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x, <span class="st">&quot;c(1,2)=NA&quot;</span>)</code></pre></div>
<pre><code>## [1] NA NA  3 NA NA  3 NA NA  3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">recode</span>(x, <span class="st">&quot;1:2=&#39;A&#39;; 3=&#39;B&#39;&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot;</code></pre>
</div>
<div id="muudame-faktori-tasemete-jarjekorda-joonisel" class="section level3">
<h3><span class="header-section-number">5.10.5</span> Muudame faktori tasemete järjekorda joonisel</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## summeerime andmed
gsscat_sum  &lt;-<span class="st"> </span><span class="kw">group_by</span>(gss_cat, relig) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">age =</span> <span class="kw">mean</span>(age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">tvhours =</span> <span class="kw">mean</span>(tvhours, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">n =</span> <span class="kw">n</span>())
## joonistame graafiku
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gsscat_sum, <span class="kw">aes</span>(tvhours, <span class="kw">fct_reorder</span>(relig, tvhours))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()
p</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-117-1.png" width="672" /></p>
</div>
<div id="fct_relevel-tostab-joonisel-osad-tasemed-teistest-ettepoole" class="section level3">
<h3><span class="header-section-number">5.10.6</span> <code>fct_relevel()</code> tõstab joonisel osad tasemed teistest ettepoole</h3>
<p>Argumendid on faktor f ja need tasemed (jutumärkides), mida sa tahad tõsta.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## täiendame eelmist graafikut ümberkorraldatud andmetega
p <span class="op">+</span><span class="st"> </span><span class="kw">aes</span>(tvhours, <span class="kw">fct_relevel</span>(relig, <span class="st">&quot;None&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>))</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
</div>
<div id="joontega-plotil-saab-fct_reorder2-abil-assotseerida-y-vaartused-suurimate-x-vaartustega" class="section level3">
<h3><span class="header-section-number">5.10.7</span> Joontega plotil saab <code>fct_reorder2()</code> abil assotseerida y väärtused suurimate x väärtustega</h3>
<p>See muudab ploti paremini jälgitavaks:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## summeerime andmed
gsscat_sum &lt;-<span class="st"> </span><span class="kw">filter</span>(gss_cat, <span class="op">!</span><span class="kw">is.na</span>(age)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(age, marital) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">N=</span><span class="kw">n</span>())
## paneme andmed graafikule
<span class="kw">ggplot</span>(gsscat_sum, <span class="kw">aes</span>(age, N, <span class="dt">colour =</span> <span class="kw">fct_reorder2</span>(marital, age, N))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;marital&quot;</span>)</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
</div>
<div id="tulpdiagrammide-korral-kasuta-fct_infreq" class="section level3">
<h3><span class="header-section-number">5.10.8</span> Tulpdiagrammide korral kasuta <code>fct_infreq()</code></h3>
<p>Loeme kokku erineva perekondliku staatusega isikud ja paneme need andmed tulpdiagrammi grupi suurusele vastupidises järjekorras st. väiksemad grupid tulevad enne.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(gss_cat, <span class="dt">marital =</span> <span class="kw">fct_infreq</span>(marital) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_rev</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(marital)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="main_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pakettide-installeerimine.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="funs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstats-tartu/lectures/edit/master/03-kalkulaator.Rmd",
"text": "Edit"
},
"download": ["main.pdf", "main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
